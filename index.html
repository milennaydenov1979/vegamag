<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>VEGAMAG</title>
<style>
:root{
  --bg:#09090f;--surface:#111119;--card:#16161f;--border:#22223a;
  --accent:#f0a830;--green:#2ecc71;--red:#e74c3c;
  --blue:#5ba4f5;--purple:#b07ef8;--dim:#5a5a80;
  --text:#e8e8f4;--text2:#9090b8;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:'Courier New',monospace;font-size:17px;min-height:100vh;padding-bottom:90px;-webkit-font-smoothing:antialiased;}

.topbar{background:var(--bg);border-bottom:1px solid var(--border);padding:16px 18px 12px;position:sticky;top:0;z-index:50;display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:21px;font-weight:900;color:var(--accent);letter-spacing:3px;}
.logo-sub{font-size:10px;color:var(--dim);letter-spacing:2px;margin-top:2px;}
.score-label{font-size:10px;color:var(--dim);letter-spacing:1px;text-align:right;}
.score-val{font-size:33px;font-weight:900;font-family:monospace;text-align:right;line-height:1;}

.nav{position:fixed;bottom:0;left:0;right:0;background:#0c0c14;border-top:1px solid var(--border);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom);}
.nav-btn{flex:1;padding:10px 2px 8px;background:none;border:none;color:var(--dim);font-family:inherit;font-size:10px;font-weight:700;letter-spacing:0.5px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:3px;}
.nav-btn .icon{font-size:22px;}
.nav-btn.active{color:var(--accent);}

.view{display:none;padding:16px;max-width:600px;margin:0 auto;}
.view.active{display:block;}

.card{background:var(--surface);border:1.5px solid var(--border);border-radius:16px;padding:16px;margin-bottom:14px;}
.card-title{font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:14px;}

.field{margin-bottom:14px;}
.field label{font-size:14px;color:var(--text2);display:block;margin-bottom:7px;line-height:1.4;}
input,textarea,select{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:16px;padding:12px 14px;outline:none;-webkit-appearance:none;appearance:none;}
input:focus,textarea:focus{border-color:var(--accent);}
textarea{min-height:78px;resize:vertical;line-height:1.5;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

.btn{display:block;width:100%;background:var(--accent);color:#000;border:2px solid var(--accent);border-radius:12px;padding:14px 20px;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;letter-spacing:0.5px;margin-top:12px;text-align:center;}
.btn:active{opacity:0.75;}
.btn.outline{background:transparent;color:var(--accent);}
.btn.green{background:var(--green);border-color:var(--green);color:#000;}
.btn.purple{background:var(--purple);border-color:var(--purple);color:#000;}
.btn.sm{width:auto;padding:9px 18px;font-size:14px;margin-top:0;}
.btn.sm-dim{width:auto;padding:9px 18px;font-size:13px;margin-top:0;background:transparent;color:var(--dim);border:1.5px solid var(--border);}

.counters{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.counter{background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:14px 12px;}
.counter-label{font-size:12px;color:var(--dim);letter-spacing:0.5px;margin-bottom:10px;font-weight:700;}
.counter-row{display:flex;align-items:center;gap:6px;}
.cnt-btn{width:38px;height:38px;border-radius:50%;flex-shrink:0;border:1.5px solid var(--border);background:#ffffff11;color:var(--text);font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;}
.counter-val{font-size:32px;font-weight:900;font-family:monospace;flex:1;text-align:center;}
.progress-bar{height:5px;background:var(--border);border-radius:3px;margin-top:10px;overflow:hidden;}
.progress-fill{height:100%;border-radius:3px;transition:width 0.4s;}

.revenue-box{background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:16px;margin-top:12px;}
.revenue-label{font-size:11px;color:var(--dim);letter-spacing:1px;}
.revenue-val{font-size:36px;font-weight:900;color:var(--green);font-family:monospace;margin:4px 0 12px;}
.quick-btns{display:flex;gap:8px;flex-wrap:wrap;}
.qbtn{background:#2ecc7122;border:1.5px solid #2ecc7133;color:var(--green);border-radius:8px;padding:9px 14px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;}

.badge{display:inline-block;border-radius:5px;padding:3px 9px;font-size:12px;font-weight:700;letter-spacing:0.5px;}

.banner{border-radius:10px;padding:12px 14px;font-size:14px;margin-bottom:12px;line-height:1.5;}
.banner.green{background:#2ecc7111;border:1px solid #2ecc7133;color:var(--green);}
.banner.accent{background:#f0a83011;border:1px solid #f0a83033;color:var(--accent);}
.banner.dim{background:var(--card);border:1px solid var(--border);color:var(--text2);font-size:13px;}

.mit-box{background:#f0a83011;border:1.5px solid #f0a83033;border-radius:14px;padding:14px;margin-bottom:14px;}
.mit-lbl{font-size:11px;color:var(--accent);letter-spacing:1px;margin-bottom:6px;}
.mit-txt{font-size:17px;color:var(--text);font-weight:700;line-height:1.4;}

.habit-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;}
.habit-table{width:100%;border-collapse:collapse;min-width:300px;}
.habit-table th{font-size:12px;color:var(--dim);padding:6px 3px;text-align:center;}
.habit-table th.hn{text-align:left;min-width:130px;}
.habit-table td{padding:8px 3px;border-top:1px solid var(--border);}
.habit-table td.hn{font-size:15px;padding-right:10px;}
.hcheck{width:34px;height:34px;border-radius:8px;margin:0 auto;border:2px solid var(--border);background:#ffffff08;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:17px;}

.lead-card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:10px;border-left:3px solid var(--dim);}
.lead-name{font-size:18px;font-weight:700;}
.lead-meta{font-size:14px;color:var(--dim);margin:3px 0 6px;}
.lead-note{font-size:14px;color:var(--text2);margin-bottom:10px;line-height:1.4;}
.status-btns{display:flex;gap:6px;flex-wrap:wrap;}
.sbtn{border-radius:5px;padding:6px 10px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;background:transparent;}

.page-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.page-title{font-size:24px;font-weight:900;}
.page-sub{font-size:14px;color:var(--dim);margin-top:2px;}

/* ‚îÄ‚îÄ HOSTING NOTICE ‚îÄ‚îÄ */
.hosting-box{background:var(--card);border:2px solid var(--red);border-radius:18px;padding:20px;margin-bottom:16px;}
.hosting-title{font-size:19px;font-weight:900;color:var(--red);margin-bottom:10px;}
.hosting-text{font-size:15px;color:var(--text2);line-height:1.6;margin-bottom:16px;}
.step-row{display:flex;gap:12px;align-items:flex-start;margin-bottom:14px;padding:12px;background:var(--surface);border-radius:12px;}
.step-num{width:32px;height:32px;border-radius:50%;background:var(--accent);color:#000;font-weight:900;font-size:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.step-text{font-size:15px;color:var(--text);line-height:1.5;}
.step-text b{color:var(--accent);}
.step-text a{color:var(--blue);text-decoration:none;}
.url-box{background:#5ba4f511;border:1.5px solid #5ba4f533;border-radius:10px;padding:12px 14px;font-size:16px;color:var(--blue);font-weight:700;margin:8px 0;text-align:center;word-break:break-all;}

/* ‚îÄ‚îÄ API SETUP ‚îÄ‚îÄ */
.setup-box{background:var(--card);border:2px solid var(--purple);border-radius:18px;padding:20px;margin-bottom:16px;}
.setup-title{font-size:19px;font-weight:900;color:var(--purple);margin-bottom:10px;}
.setup-text{font-size:15px;color:var(--text2);line-height:1.6;margin-bottom:14px;}
.setup-steps{font-size:15px;color:var(--text);line-height:1.9;margin-bottom:16px;}
.setup-steps b{color:var(--accent);}
.api-row{display:flex;gap:8px;}
.api-row input{flex:1;font-size:14px;}
.api-save{background:var(--purple);border:none;color:#fff;border-radius:10px;padding:13px 16px;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;flex-shrink:0;}
.api-saved{background:#2ecc7111;border:1px solid #2ecc7133;color:var(--green);border-radius:10px;padding:11px 14px;font-size:14px;font-weight:700;display:none;margin-top:10px;text-align:center;}

/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
.ai-header{background:var(--card);border:1.5px solid var(--purple);border-radius:16px;padding:14px 16px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center;}
.ai-h-title{font-size:16px;font-weight:900;color:var(--purple);}
.ai-h-sub{font-size:13px;color:var(--text2);margin-top:2px;}
.chat-area{background:var(--card);border:1.5px solid var(--border);border-radius:16px;padding:14px;min-height:180px;margin-bottom:12px;max-height:48vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.msg{margin-bottom:14px;animation:fi 0.25s ease;}
@keyframes fi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.msg-user{text-align:right;}
.msg-bubble{display:inline-block;max-width:90%;border-radius:14px;padding:12px 15px;font-size:15px;line-height:1.55;text-align:left;}
.msg-user .msg-bubble{background:var(--accent);color:#000;font-weight:600;}
.msg-ai .msg-bubble{background:#22223a;color:var(--text);border:1px solid var(--border);}
.msg-ai .msg-bubble b{color:var(--accent);}
.msg-label{font-size:11px;color:var(--dim);margin-bottom:4px;letter-spacing:0.5px;}
.chat-input-row{display:flex;gap:8px;}
.chat-input-row textarea{flex:1;min-height:54px;font-size:16px;padding:12px;}
.send-btn{width:54px;height:54px;border-radius:14px;flex-shrink:0;background:var(--purple);border:none;color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;align-self:flex-end;}
.send-btn:disabled{opacity:0.35;}
.quick-prompts{display:flex;flex-direction:column;gap:8px;margin-bottom:12px;}
.qp-btn{background:var(--surface);border:1.5px solid var(--border);border-radius:12px;padding:14px 16px;font-family:inherit;font-size:15px;color:var(--text);cursor:pointer;text-align:left;line-height:1.4;}
.qp-btn:active{border-color:var(--purple);}
.empty-chat{color:var(--dim);font-size:15px;text-align:center;padding:20px;}
.typing{display:flex;gap:5px;padding:6px 2px;}
.typing span{width:8px;height:8px;border-radius:50%;background:var(--purple);animation:bl 1.2s infinite;}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes bl{0%,80%,100%{opacity:0.2}40%{opacity:1}}

.stat-big{font-size:36px;font-weight:900;font-family:monospace;}
</style>
</head>
<body>

<div class="topbar">
  <div><div class="logo">VEGAMAG</div><div class="logo-sub">COMMAND CENTER</div></div>
  <div><div class="score-label">–†–ï–ó–£–õ–¢–ê–¢ –î–ù–ï–°</div><div class="score-val" id="topScore" style="color:var(--accent)">0%</div></div>
</div>

<!-- ‚ïê‚ïê‚ïê –î–ù–ï–° ‚ïê‚ïê‚ïê -->
<div id="view-day" class="view active">
  <div class="page-row">
    <div><div class="page-title">–î–ù–ï–° ‚ö°</div><div class="page-sub" id="todayDate"></div></div>
  </div>
  <div class="mit-box" id="mitDisplay" style="display:none">
    <div class="mit-lbl">üéØ –î–ù–ï–®–ù–ò–Ø–¢ MIT:</div>
    <div class="mit-txt" id="mitText"></div>
  </div>
  <div class="card" id="morningCard">
    <div class="card-title" style="color:var(--accent)">üåÖ –°–£–¢–†–ï–®–ï–ù –ü–†–û–¢–û–ö–û–õ</div>
    <div id="mDoneBanner" class="banner green" style="display:none">‚úì –°—É—Ç—Ä–∏–Ω—Ç–∞ –µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ ‚Äî –¥–µ–π—Å—Ç–≤–∞–π!</div>
    <div class="field"><label>üéØ MIT ‚Äî –ï–¥–Ω–æ—Ç–æ –Ω–µ—â–æ, –∫–æ–µ—Ç–æ –∞–∫–æ –Ω–∞–ø—Ä–∞–≤—è –≤—Å–∏—á–∫–æ –¥—Ä—É–≥–æ –µ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ:</label><input type="text" id="mit" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –∏–∑–º–µ—Ä–∏–º–æ..." oninput="saveDay()"></div>
    <div class="field"><label>‚ö° –ë–ª–æ–∫–µ—Ä ‚Äî –ö–æ–µ –º–æ–∂–µ –¥–∞ –º–µ —Å–ø—Ä–µ –∏ –∫–∞–∫ —â–µ –≥–æ –ø—Ä–µ–æ–¥–æ–ª–µ—è:</label><input type="text" id="blocker" placeholder="–ß–µ—Å—Ç–Ω–æ..." oninput="saveDay()"></div>
    <div class="field"><label>üö´ –ù–ï ‚Äî –û—Ç –∫–∞–∫–≤–æ —â–µ –∫–∞–∂–∞ –ù–ï –¥–Ω–µ—Å –∑–∞ –¥–∞ –ø–∞–∑—è —Ñ–æ–∫—É—Å–∞:</label><input type="text" id="noToday" placeholder="–ö–æ–µ —â–µ –∏–≥–Ω–æ—Ä–∏—Ä–∞–º..." oninput="saveDay()"></div>
    <button class="btn" id="mDoneBtn" onclick="markMorningDone()">‚úì –°—É—Ç—Ä–∏–Ω—Ç–∞ –µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</button>
  </div>
  <div class="card">
    <div class="card-title" style="color:var(--blue)">üìä –î–ù–ï–í–ù–ò –î–ï–ô–°–¢–í–ò–Ø</div>
    <div style="font-size:14px;color:var(--dim);margin-bottom:14px">–¶–ï–õ: 5 –æ–±–∞–∂–¥–∞–Ω–∏—è ¬∑ 5 –ø–æ—Å—Ç–∞ ¬∑ 2 –æ—Ñ–µ—Ä—Ç–∏ ¬∑ 1 —Å–¥–µ–ª–∫–∞</div>
    <div class="counters">
      <div class="counter">
        <div class="counter-label" style="color:var(--blue)">üìû –û–ë–ê–ñ–î–ê–ù–ò–Ø</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('calls',-1)">‚àí</button>
          <div class="counter-val" id="calls-val" style="color:var(--blue)">0</div>
          <button class="cnt-btn" style="border-color:var(--blue);background:#5ba4f522;color:var(--blue)" onclick="adj('calls',1)">+</button>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="calls-bar" style="background:var(--blue);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--accent)">üìù –ü–£–ë–õ–ò–ö–ê–¶–ò–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('posts',-1)">‚àí</button>
          <div class="counter-val" id="posts-val" style="color:var(--accent)">0</div>
          <button class="cnt-btn" style="border-color:var(--accent);background:#f0a83022;color:var(--accent)" onclick="adj('posts',1)">+</button>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="posts-bar" style="background:var(--accent);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--purple)">üí¨ –û–§–ï–†–¢–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('offers',-1)">‚àí</button>
          <div class="counter-val" id="offers-val" style="color:var(--purple)">0</div>
          <button class="cnt-btn" style="border-color:var(--purple);background:#b07ef822;color:var(--purple)" onclick="adj('offers',1)">+</button>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="offers-bar" style="background:var(--purple);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--green)">‚úÖ –°–î–ï–õ–ö–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('deals',-1)">‚àí</button>
          <div class="counter-val" id="deals-val" style="color:var(--green)">0</div>
          <button class="cnt-btn" style="border-color:var(--green);background:#2ecc7122;color:var(--green)" onclick="adj('deals',1)">+</button>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="deals-bar" style="background:var(--green);width:0%"></div></div>
      </div>
    </div>
    <div class="revenue-box">
      <div class="revenue-label">üí∂ –ü–†–ò–•–û–î –î–ù–ï–°</div>
      <div class="revenue-val" id="revenue-val">0 ‚Ç¨</div>
      <div class="quick-btns">
        <button class="qbtn" onclick="addRev(50)">+50‚Ç¨</button>
        <button class="qbtn" onclick="addRev(80)">+80‚Ç¨</button>
        <button class="qbtn" onclick="addRev(120)">+120‚Ç¨</button>
        <button class="qbtn" onclick="addRev(200)">+200‚Ç¨</button>
        <button class="qbtn" onclick="addRevCustom()">+–¥—Ä—É–≥–æ</button>
      </div>
    </div>
  </div>
  <div class="card" id="eveningCard">
    <div class="card-title" style="color:var(--purple)">üåô –í–ï–ß–ï–†–ï–ù –ü–†–ï–ì–õ–ï–î</div>
    <div id="eDoneBanner" class="banner green" style="display:none">‚úì –î–µ–Ω—è—Ç –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω ‚Äî —É—Ç—Ä–µ –æ—Ç–Ω–æ–≤–æ!</div>
    <div class="field"><label>–ù–∞–ø—Ä–∞–≤–∏—Ö –ª–∏ MIT-–∞? –ê–∫–æ –Ω–µ ‚Äî –∑–∞—â–æ —Ç–æ—á–Ω–æ?</label><textarea id="eq1" placeholder="–ß–µ—Å—Ç–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä..." oninput="saveDay()"></textarea></div>
    <div class="field"><label>–ö–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–Ω–µ—Å –¥–æ–±–ª–∏–∂–∏ –º–µ–Ω –∏ —Å–µ–º–µ–π—Å—Ç–≤–æ—Ç–æ –º–∏ –¥–æ —Å—Ç–∞–±–∏–ª–Ω–æ—Å—Ç?</label><textarea id="eq2" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ..." oninput="saveDay()"></textarea></div>
    <div class="field"><label>–ï–¥–Ω–æ –Ω–µ—â–æ –∫–æ–µ—Ç–æ —É—Ç—Ä–µ —â–µ –Ω–∞–ø—Ä–∞–≤—è —Ä–∞–∑–ª–∏—á–Ω–æ:</label><textarea id="eq3" placeholder="–°–∞–º–æ 1 –Ω–µ—â–æ..." oninput="saveDay()"></textarea></div>
    <button class="btn purple" id="eDoneBtn" onclick="markEveningDone()">‚úì –î–µ–Ω—è—Ç –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω</button>
  </div>
  <div class="card">
    <div class="card-title" style="color:var(--dim)">üìå –ë–™–†–ó–ê –ë–ï–õ–ï–ñ–ö–ê</div>
    <textarea id="dayNote" placeholder="–ù–µ—â–æ –≤–∞–∂–Ω–æ –¥–∞ –Ω–µ –∑–∞–±—Ä–∞–≤–∏—à..." oninput="saveDay()"></textarea>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê AI –ö–û–£–ß ‚ïê‚ïê‚ïê -->
<div id="view-ai" class="view">
  <div class="page-row">
    <div><div class="page-title">AI –ö–û–£–ß ü§ñ</div><div class="page-sub">–õ–∏—á–µ–Ω –±–∏–∑–Ω–µ—Å –ø–∞—Ä—Ç–Ω—å–æ—Ä</div></div>
  </div>

  <!-- –°–¢–™–ü–ö–ê 0: –§–∞–π–ª—ä—Ç —Å–µ –æ—Ç–≤–∞—Ä—è –æ—Ç file:// -->
  <div id="hostingNotice" style="display:none">
    <div class="hosting-box">
      <div class="hosting-title">‚ö†Ô∏è –ù—É–∂–µ–Ω –µ —Ö–æ—Å—Ç–∏–Ω–≥ (1 –º–∏–Ω)</div>
      <div class="hosting-text">–ó–∞ –¥–∞ —Ä–∞–±–æ—Ç–∏ AI –ö–æ—É—á—ä—Ç, —Ñ–∞–π–ª—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –Ω–∞ —É–µ–±—Å–∞–π—Ç ‚Äî –Ω–µ –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ï—Ç–æ –Ω–∞–π-–ª–µ—Å–Ω–∏—è—Ç –Ω–∞—á–∏–Ω (–±–µ–∑–ø–ª–∞—Ç–Ω–æ, 60 —Å–µ–∫—É–Ω–¥–∏):</div>

      <div class="step-row">
        <div class="step-num">1</div>
        <div class="step-text">–ù–∞ –∫–æ–º–ø—é—Ç—ä—Ä –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –æ—Ç–≤–æ—Ä–∏:<br><div class="url-box">netlify.com/drop</div></div>
      </div>
      <div class="step-row">
        <div class="step-num">2</div>
        <div class="step-text">–ü–ª—ä–∑–Ω–∏ —Ñ–∞–π–ª–∞ <b>vegamag.html</b> –≤ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞<br><span style="color:var(--dim);font-size:13px">(–∏–ª–∏ –Ω–∞—Ç–∏—Å–Ω–∏ "browse to upload" –∏ –∏–∑–±–µ—Ä–∏ —Ñ–∞–π–ª–∞)</span></div>
      </div>
      <div class="step-row">
        <div class="step-num">3</div>
        <div class="step-text">Netlify —â–µ —Ç–∏ –¥–∞–¥–µ –ª–∏–Ω–∫ –∫–∞—Ç–æ:<br><div class="url-box">random-name-123.netlify.app</div>–û—Ç–≤–æ—Ä–∏ –≥–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Äî –≥–æ—Ç–æ–≤–æ! ‚úÖ</div>
      </div>
      <div class="step-row">
        <div class="step-num">4</div>
        <div class="step-text">–î–æ–±–∞–≤–∏ –ª–∏–Ω–∫–∞ –Ω–∞ <b>–Ω–∞—á–∞–ª–Ω–∏—è –µ–∫—Ä–∞–Ω</b> –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞:<br>Safari: Share ‚Üí "Add to Home Screen"<br>Chrome: –ú–µ–Ω—é ‚Üí "Add to Home Screen"</div>
      </div>

      <div style="font-size:13px;color:var(--dim);margin-top:4px;line-height:1.6">
        üí° –î–∞–Ω–Ω–∏—Ç–µ —Ç–∏ (–ª–∏–π–¥–æ–≤–µ, –Ω–∞–≤–∏—Ü–∏, –ø—Ä–æ–≥—Ä–µ—Å) —Å–µ –ø–∞–∑—è—Ç –≤ –±—Ä–∞—É–∑—ä—Ä–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–µ –≤ –æ–±–ª–∞–∫–∞. –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –ª–∏—á–Ω–æ.
      </div>
    </div>
  </div>

  <!-- –°–¢–™–ü–ö–ê 1: API –∫–ª—é—á -->
  <div id="setupBox" style="display:none">
    <div class="setup-box">
      <div class="setup-title">üîë API –∫–ª—é—á (1 –º–∏–Ω)</div>
      <div class="setup-text">–ù—É–∂–µ–Ω –µ –ª–∏—á–µ–Ω –∫–ª—é—á –æ—Ç Anthropic. <b>–ë–µ–∑–ø–ª–∞—Ç–Ω–æ</b> ‚Äî –¥–∞–≤–∞—Ç $5 –∫—Ä–µ–¥–∏—Ç –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–∏ –∑–∞ —Å—Ç–æ—Ç–∏—Ü–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞).</div>
      <div class="setup-steps">
        <b>1.</b> –û—Ç–≤–æ—Ä–∏ <b>console.anthropic.com</b><br>
        <b>2.</b> –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π —Å–µ / –≤–ª–µ–∑<br>
        <b>3.</b> "API Keys" ‚Üí "Create Key"<br>
        <b>4.</b> –ö–æ–ø–∏—Ä–∞–π –∫–ª—é—á–∞ (–∑–∞–ø–æ—á–≤–∞ —Å <b>sk-ant-</b>)<br>
        <b>5.</b> –ü–æ—Å—Ç–∞–≤–∏ –≥–æ —Ç—É–∫:
      </div>
      <div class="api-row">
        <input type="password" id="apiKeyInput" placeholder="sk-ant-api03-..." autocomplete="off">
        <button class="api-save" onclick="saveApiKey()">üíæ –ó–∞–ø–∞–∑–∏</button>
      </div>
      <div id="apiSaved" class="api-saved">‚úÖ –ö–ª—é—á—ä—Ç –µ –∑–∞–ø–∞–∑–µ–Ω ‚Äî AI –ö–æ—É—á—ä—Ç –µ –≥–æ—Ç–æ–≤!</div>
    </div>
  </div>

  <!-- –°–¢–™–ü–ö–ê 2: –ß–∞—Ç -->
  <div id="chatSection" style="display:none">
    <div class="ai-header">
      <div>
        <div class="ai-h-title">ü§ñ AI –ö–æ—É—á ‚Äî –æ–Ω–ª–∞–π–Ω</div>
        <div class="ai-h-sub">–ó–Ω–∞–µ –∑–∞ Vegamag, —Ü–µ–ª–∏—Ç–µ –∏ –Ω–∞–≤–∏—Ü–∏—Ç–µ —Ç–∏</div>
      </div>
      <button class="btn sm-dim" onclick="changeApiKey()">üîë –°–º–µ–Ω–∏ –∫–ª—é—á</button>
    </div>

    <div class="quick-prompts" id="quickPrompts">
      <button class="qp-btn" onclick="sendQuick('–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –º–æ—è –¥–µ–Ω –¥–Ω–µ—Å –∏ –º–∏ –¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –Ω–∞—Å–æ–∫–∏ –∑–∞ —É—Ç—Ä–µ.')">üìä –ê–Ω–∞–ª–∏–∑ –Ω–∞ –¥–Ω–µ—à–Ω–∏—è –¥–µ–Ω</button>
      <button class="qp-btn" onclick="sendQuick('–ö–æ–∏ —Å–∞ –º–æ–∏—Ç–µ 3 –Ω–∞–π-–≤–∞–∂–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –∑–∞ –ø–æ–≤–µ—á–µ –ø—Ä–∏—Ö–æ–¥ –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏ —É—Å–ª—É–≥–∏ —Å–ª–µ–¥ 17:30?')">üí∂ –ö–∞–∫ –¥–∞ —É–≤–µ–ª–∏—á–∞ –ø—Ä–∏—Ö–æ–¥–∞ –±—ä—Ä–∑–æ?</button>
      <button class="qp-btn" onclick="sendQuick('–û—Ü–µ–Ω–∏ –º–æ–∏—Ç–µ –Ω–∞–≤–∏—Ü–∏ –∏ –º–∏ –∫–∞–∂–∏ —á–µ—Å—Ç–Ω–æ –∫–æ–µ –º–µ —Å–ø–∏—Ä–∞ –æ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç.')">üî• –ö–æ–π –Ω–∞–≤–∏–∫ –º–µ —Å–ø–∏—Ä–∞?</button>
      <button class="qp-btn" onclick="sendQuick('–î–∞–π –º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω 30-–¥–Ω–µ–≤–µ–Ω –ø–ª–∞–Ω –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ 3000‚Ç¨ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏—è –±–∏–∑–Ω–µ—Å —Å–ª–µ–¥ 17:30.')">üöÄ 30-–¥–Ω–µ–≤–µ–Ω –ø–ª–∞–Ω –∑–∞ 3000‚Ç¨</button>
      <button class="qp-btn" onclick="sendQuick('–ö–∞–∫ –¥–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–∞–º SmartBooks –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏—è –±–∏–∑–Ω–µ—Å –±–µ–∑ –¥–∞ —Å–µ —Ä–∞–∑–ø–∏–ª—è–≤–∞–º? –ö–æ–π –µ –≤–æ–¥–µ—â —Å–µ–≥–∞?')">‚öñÔ∏è –ö–∞–∫ –¥–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–∞–º –ø—Ä–æ–µ–∫—Ç–∏—Ç–µ?</button>
    </div>

    <div class="chat-area" id="chatArea">
      <div class="empty-chat">–ò–∑–±–µ—Ä–∏ –≤—ä–ø—Ä–æ—Å –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π ‚Üì</div>
    </div>

    <div class="chat-input-row">
      <textarea id="chatInput" placeholder="–ü–∏—Ç–∞–π –∑–∞ –±–∏–∑–Ω–µ—Å, –Ω–∞–≤–∏—Ü–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è..." onkeydown="handleKey(event)"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendChat()">‚û§</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê –õ–ò–ô–î–û–í–ï ‚ïê‚ïê‚ïê -->
<div id="view-leads" class="view">
  <div class="page-row">
    <div><div class="page-title">–õ–ò–ô–î–û–í–ï üë•</div><div class="page-sub" id="leadsCount">0 –∞–∫—Ç–∏–≤–Ω–∏</div></div>
    <button class="btn sm" onclick="toggleLeadForm()">+ –ù–û–í</button>
  </div>
  <div class="card" id="leadForm" style="display:none">
    <div class="card-title" style="color:var(--accent)">–ù–û–í –õ–ò–ô–î</div>
    <div class="grid2">
      <div class="field"><label>–ò–º–µ</label><input type="text" id="lName" placeholder="–ò–≤–∞–Ω"></div>
      <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="lPhone" placeholder="0888..."></div>
    </div>
    <div class="grid2">
      <div class="field"><label>–ò–∑—Ç–æ—á–Ω–∏–∫</label>
        <select id="lSource"><option>FB</option><option>OLX</option><option>–ü—Ä–µ–ø–æ—Ä—ä–∫–∞</option><option>–î–∏—Ä–µ–∫—Ç–Ω–æ</option><option>–¢–µ–ª–µ—Ñ–æ–Ω</option><option>–î—Ä—É–≥–æ</option></select>
      </div>
      <div class="field"><label>–°—Ç–∞—Ç—É—Å</label>
        <select id="lStatus"><option>–ù–û–í</option><option>–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù</option><option>–û–§–ï–†–¢–ê</option><option>–ü–û–¢–í–™–†–î–ï–ù</option><option>–ü–õ–ê–¢–ï–ù</option></select>
      </div>
    </div>
    <div class="field"><label>–ë–µ–ª–µ–∂–∫–∞</label><textarea id="lNote" placeholder="–ö–∞–∫–≤–æ –∏—Å–∫–∞, —Ü–µ–Ω–∞, –∫–æ–≥–∞..."></textarea></div>
    <button class="btn" onclick="addLead()">–î–æ–±–∞–≤–∏ –ª–∏–π–¥</button>
  </div>
  <div id="leadsList"></div>
</div>

<!-- ‚ïê‚ïê‚ïê –ù–ê–í–ò–¶–ò ‚ïê‚ïê‚ïê -->
<div id="view-habits" class="view">
  <div class="page-row">
    <div><div class="page-title">–ù–ê–í–ò–¶–ò üî•</div><div class="page-sub">–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 7 –¥–Ω–∏</div></div>
  </div>
  <div class="card">
    <div id="habitScore" class="banner accent" style="font-size:16px;font-weight:700;margin-bottom:14px">–î–Ω–µ—Å: 0/6 –Ω–∞–≤–∏–∫–∞</div>
    <div class="habit-scroll">
      <table class="habit-table"><thead id="habitHead"></thead><tbody id="habitBody"></tbody></table>
    </div>
  </div>
  <div class="card" style="font-size:15px;color:var(--text2);line-height:1.7">
    <div style="font-size:16px;font-weight:700;color:var(--text);margin-bottom:8px">–ó–∞—â–æ –Ω–∞–≤–∏—Ü–∏—Ç–µ –ø—Ä–æ–º–µ–Ω—è—Ç –≤—Å–∏—á–∫–æ:</div>
    –ù–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –Ω–µ –º–æ—Ç–∏–≤–∞—Ü–∏—è ‚Äî —Å–∏—Å—Ç–µ–º–∞. –í—Å—è–∫–æ ‚úì –µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–æ, —á–µ —Ç–∏ —Å–∏ —á–æ–≤–µ–∫—ä—Ç, –∫–æ–π—Ç–æ –ø—Ä–∞–≤–∏ —Ç–µ–∑–∏ –Ω–µ—â–∞. 1 –º–∞–ª–∫–∞ —Å—Ç—ä–ø–∫–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω = 365 —Å—Ç—ä–ø–∫–∏ –≥–æ–¥–∏—à–Ω–æ.
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê –°–ï–î–ú–ò–¶–ê ‚ïê‚ïê‚ïê -->
<div id="view-week" class="view">
  <div class="page-row">
    <div><div class="page-title">–°–ï–î–ú–ò–¶–ê üìä</div><div class="page-sub" id="weekLabel"></div></div>
  </div>
  <div class="card">
    <div class="card-title" style="color:var(--accent)">üéØ –§–û–ö–£–° –ù–ê –ü–†–û–ï–ö–¢–ò–¢–ï</div>
    <div class="banner dim">–ü–†–ê–í–ò–õ–û: 1 –í–û–î–ï–© (80% –æ—Ç –≤—Ä–µ–º–µ—Ç–æ) + 1 –ü–û–î–î–™–†–ñ–ê–ù (20% ‚Äî —Å–∞–º–æ –Ω–µ —É–º–∏—Ä–∞). –î–≤–∞—Ç–∞ –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ = –Ω–∏—Ç–æ –µ–¥–∏–Ω –Ω–∞–ø—Ä–µ–¥.</div>
    <div class="field"><label>ü•á –í–æ–¥–µ—â –ø—Ä–æ–µ–∫—Ç —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ (80%):</label><input type="text" id="wLead" placeholder="–Ω–∞–ø—Ä. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–ª–µ–¥ 17:30" oninput="saveWeek()"></div>
    <div class="field"><label>üîÑ –ü–æ–¥–¥—ä—Ä–∂–∞–Ω (20% ‚Äî —Å–∞–º–æ –Ω–µ —É–º–∏—Ä–∞):</label><input type="text" id="wHold" placeholder="–Ω–∞–ø—Ä. SmartBooks" oninput="saveWeek()"></div>
  </div>
  <div class="card">
    <div class="card-title" style="color:var(--purple)">üß† –ú–ï–¢–ê –í–™–ü–†–û–°–ò (–Ω–µ–¥–µ–ª—è –≤–µ—á–µ—Ä)</div>
    <div class="field"><label>–ö–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Ä–µ–∞–ª–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç?</label><textarea id="wq1" placeholder="–°–∞–º–æ 1-2 –Ω–µ—â–∞ —á–µ—Å—Ç–Ω–æ..." oninput="saveWeek()"></textarea></div>
    <div class="field"><label>–ê–∫–æ –∏–º–∞—Ö —Å–∞–º–æ 3 —á–∞—Å–∞ ‚Äî –Ω–∞ –∫–∞–∫–≤–æ —â—è—Ö –¥–∞ –≥–∏ –¥–∞–º?</label><textarea id="wq2" placeholder="80/20 –ø—Ä–∏–Ω—Ü–∏–ø..." oninput="saveWeek()"></textarea></div>
    <div class="field"><label>–ö–∞–∫–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –°–ü–†–ê –¥–∞ –ø—Ä–∞–≤—è?</label><textarea id="wq3" placeholder="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–µ–∑ –µ—Ñ–µ–∫—Ç..." oninput="saveWeek()"></textarea></div>
  </div>
  <div class="card">
    <div class="card-title" style="color:var(--green)">üí∂ –°–ï–î–ú–ò–ß–ï–ù –ü–†–ò–•–û–î</div>
    <div class="stat-big" id="wRevenue" style="color:var(--green)">0 ‚Ç¨</div>
    <div class="quick-btns" style="margin-top:12px">
      <button class="qbtn" onclick="addWR(100)">+100‚Ç¨</button>
      <button class="qbtn" onclick="addWR(200)">+200‚Ç¨</button>
      <button class="qbtn" onclick="addWR(500)">+500‚Ç¨</button>
      <button class="qbtn" onclick="addWR(1000)">+1000‚Ç¨</button>
    </div>
  </div>
</div>

<!-- NAV -->
<nav class="nav">
  <button class="nav-btn active" id="nav-day" onclick="showView('day')"><span class="icon">‚ö°</span>–î–ù–ï–°</button>
  <button class="nav-btn" id="nav-ai" onclick="showView('ai')"><span class="icon">ü§ñ</span>AI –ö–û–£–ß</button>
  <button class="nav-btn" id="nav-leads" onclick="showView('leads')"><span class="icon">üë•</span>–õ–ò–ô–î–û–í–ï</button>
  <button class="nav-btn" id="nav-habits" onclick="showView('habits')"><span class="icon">üî•</span>–ù–ê–í–ò–¶–ò</button>
  <button class="nav-btn" id="nav-week" onclick="showView('week')"><span class="icon">üìä</span>–°–ï–î–ú–ò–¶–ê</button>
</nav>

<script>
// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
const todayKey=()=>new Date().toISOString().split('T')[0];
const weekKey=()=>'week:'+todayKey().slice(0,7);
const ls={
  get:(k,d)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):d}catch{return d}},
  set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}},
  raw:(k)=>{try{return localStorage.getItem(k)||''}catch{return ''}},
  setRaw:(k,v)=>{try{localStorage.setItem(k,v)}catch{}}
};
const fmtEur=n=>(n||0)+' ‚Ç¨';
const last7=()=>Array.from({length:7},(_,i)=>{const d=new Date();d.setDate(d.getDate()-(6-i));return d.toISOString().split('T')[0]});
const dn=['–ù–¥','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
const esc=t=>String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const isFileProtocol=()=>location.protocol==='file:';

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
const DKEY='day:'+todayKey();
let D=ls.get(DKEY,{mit:'',blocker:'',noToday:'',calls:0,posts:0,offers:0,deals:0,revenue:0,eq1:'',eq2:'',eq3:'',note:'',morningDone:false,eveningDone:false});
let leads=ls.get('leads:all',[]);
let W=ls.get(weekKey(),{lead:'',hold:'',wq1:'',wq2:'',wq3:'',revenue:0});
let H=ls.get('habits:all',{done:{}});
let chatHistory=[];

const HABITS=[
  {id:'morning',label:'üåÖ –°—É—Ç—Ä–µ—à–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª'},
  {id:'mit90',  label:'üéØ MIT —Ä–∞–±–æ—Ç–∞ 90+ –º–∏–Ω'},
  {id:'calls5', label:'üìû 5+ –æ–±–∞–∂–¥–∞–Ω–∏—è'},
  {id:'posts5', label:'üìù 5+ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏'},
  {id:'noscrol',label:'üö´ –ë–µ–∑ –±–µ–∑—Å–º–∏—Å–ª–µ–Ω —Å–∫—Ä–æ–ª'},
  {id:'evening',label:'üåô –í–µ—á–µ—Ä–µ–Ω –ø—Ä–µ–≥–ª–µ–¥'},
];
const SC={–ù–û–í:'#5ba4f5',–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù:'#f0a830',–û–§–ï–†–¢–ê:'#b07ef8',–ü–û–¢–í–™–†–î–ï–ù:'#2ecc71',–ü–õ–ê–¢–ï–ù:'#2ecc71',–û–¢–ö–ê–ó–ê–ù:'#e74c3c'};

// ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ
function showView(v){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
  document.getElementById('view-'+v).classList.add('active');
  document.getElementById('nav-'+v).classList.add('active');
  if(v==='leads')renderLeads();
  if(v==='habits')renderHabits();
  if(v==='ai')initAiView();
}

// ‚îÄ‚îÄ DAY ‚îÄ‚îÄ
function initDay(){
  const d=new Date();
  document.getElementById('todayDate').textContent=d.toLocaleDateString('bg-BG',{weekday:'long',day:'numeric',month:'long'});
  ['mit','blocker','noToday','eq1','eq2','eq3','dayNote'].forEach(id=>{
    const el=document.getElementById(id);
    if(el)el.value=D[id==='dayNote'?'note':id]||'';
  });
  ['calls','posts','offers','deals'].forEach(f=>updateCUI(f));
  updateRevUI();
  if(D.morningDone)applyMorningDone();
  if(D.eveningDone)applyEveningDone();
  updateMitDisplay();updateScore();
}
function saveDay(){
  ['mit','blocker','noToday','eq1','eq2','eq3','dayNote'].forEach(id=>{
    const el=document.getElementById(id);
    if(el)D[id==='dayNote'?'note':id]=el.value;
  });
  ls.set(DKEY,D);updateMitDisplay();
}
function updateMitDisplay(){
  const box=document.getElementById('mitDisplay');
  if(D.mit&&D.morningDone){box.style.display='block';document.getElementById('mitText').textContent=D.mit;}
  else box.style.display='none';
}
function adj(f,delta){D[f]=Math.max(0,(D[f]||0)+delta);ls.set(DKEY,D);updateCUI(f);updateScore();}
function updateCUI(f){
  const goals={calls:5,posts:5,offers:2,deals:1};
  const val=D[f]||0,pct=Math.min(100,Math.round(val/(goals[f]||1)*100));
  document.getElementById(f+'-val').textContent=val;
  document.getElementById(f+'-bar').style.width=pct+'%';
}
function addRev(a){D.revenue=(D.revenue||0)+a;ls.set(DKEY,D);updateRevUI();updateScore();}
function addRevCustom(){const a=prompt('–°—É–º–∞ –≤ ‚Ç¨:');if(a&&!isNaN(a))addRev(Number(a));}
function updateRevUI(){document.getElementById('revenue-val').textContent=fmtEur(D.revenue);}
function updateScore(){
  const c=Math.min(1,(D.calls||0)/5),p=Math.min(1,(D.posts||0)/5),o=Math.min(1,(D.offers||0)/2),dl=D.deals>0?1:0;
  const s=Math.round((c+p+o+dl)/4*100);
  const el=document.getElementById('topScore');
  el.textContent=s+'%';
  el.style.color=s>=75?'#2ecc71':s>=40?'#f0a830':'#e74c3c';
}
function markMorningDone(){D.morningDone=true;ls.set(DKEY,D);applyMorningDone();updateMitDisplay();}
function applyMorningDone(){
  document.getElementById('mDoneBanner').style.display='block';
  document.getElementById('mDoneBtn').style.display='none';
  document.getElementById('morningCard').style.borderColor='#2ecc7144';
}
function markEveningDone(){D.eveningDone=true;saveDay();applyEveningDone();}
function applyEveningDone(){
  document.getElementById('eDoneBanner').style.display='block';
  document.getElementById('eDoneBtn').style.display='none';
  document.getElementById('eveningCard').style.borderColor='#2ecc7144';
}

// ‚îÄ‚îÄ AI VIEW LOGIC ‚îÄ‚îÄ
function initAiView(){
  const isFile=isFileProtocol();
  const hasKey=!!getApiKey();
  document.getElementById('hostingNotice').style.display=isFile?'block':'none';
  document.getElementById('setupBox').style.display=(!isFile&&!hasKey)?'block':'none';
  document.getElementById('chatSection').style.display=(!isFile&&hasKey)?'block':'none';
}
function getApiKey(){return ls.raw('vegamag_api_key');}
function saveApiKey(){
  const key=document.getElementById('apiKeyInput').value.trim();
  if(!key.startsWith('sk-ant-')){
    alert('–ö–ª—é—á—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –∑–∞–ø–æ—á–≤–∞ —Å "sk-ant-"\n–ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å–∏ –∫–æ–ø–∏—Ä–∞–ª —Ü–µ–ª–∏—è –∫–ª—é—á.');
    return;
  }
  ls.setRaw('vegamag_api_key',key);
  document.getElementById('apiSaved').style.display='block';
  setTimeout(()=>initAiView(),1200);
}
function changeApiKey(){
  ls.setRaw('vegamag_api_key','');
  chatHistory=[];
  document.getElementById('chatArea').innerHTML='<div class="empty-chat">–ò–∑–±–µ—Ä–∏ –≤—ä–ø—Ä–æ—Å –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π ‚Üì</div>';
  document.getElementById('quickPrompts').style.display='flex';
  initAiView();
}

// ‚îÄ‚îÄ AI CONTEXT ‚îÄ‚îÄ
function buildContext(){
  const today=todayKey();
  const hDone=HABITS.filter(h=>H.done[h.id+':'+today]).map(h=>h.label);
  const hPct=Math.round(hDone.length/HABITS.length*100);
  const score=Math.round((Math.min(1,(D.calls||0)/5)+Math.min(1,(D.posts||0)/5)+Math.min(1,(D.offers||0)/2)+(D.deals>0?1:0))/4*100);
  return `–ö–û–ù–¢–ï–ö–°–¢ ‚Äî –ú–ò–õ–ï–ù –ê–ô–î–ï–ù–û–í / VEGAMAG –ï–û–û–î:

–ë–ò–ó–ù–ï–°:
- –§–∏—Ä–º–∞: Vegamag –ï–û–û–î
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏ —É—Å–ª—É–≥–∏ —Å –ª–∏—á–µ–Ω –±—É—Å —Å–ª–µ–¥ 17:30 –∏ —É–∏–∫–µ–Ω–¥
- –í—Ç–æ—Ä–∏ –ø—Ä–æ–µ–∫—Ç: SmartBooks.bg (AI —Å—á–µ—Ç–æ–≤–æ–¥–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
- –§–∏–Ω–∞–Ω—Å–∏: –∏–ø–æ—Ç–µ–∫–∞ + –∑–∞–µ–º–∏ + –∑–∞–ø–æ—Ä ~10 000‚Ç¨; –Ω—É–∂–¥–∞ –æ—Ç +2000-4000‚Ç¨/–º–µ—Å –ë–™–†–ó–û
- –°–µ–º–µ–π—Å—Ç–≤–æ: —Å—ä–ø—Ä—É–≥–∞ + 3 –¥–µ—Ü–∞ (1-–≤–∏, 4-—Ç–∏, 8-–º–∏ –∫–ª–∞—Å); —Å—ä–ø—Ä—É–≥–∞ —Å 30 000‚Ç¨ –∫—Ä–µ–¥–∏—Ç–∏
- –û—Å–Ω–æ–≤–Ω–∞ –∑–∞–ø–ª–∞—Ç–∞: ~1000‚Ç¨/–º–µ—Å

–î–ù–ï–° (${today}):
MIT: ${D.mit||'(–Ω–µ –µ –ø–æ–ø—ä–ª–Ω–µ–Ω)'}
–ë–ª–æ–∫–µ—Ä: ${D.blocker||'(–Ω–µ –µ –ø–æ–ø—ä–ª–Ω–µ–Ω)'}
–û–±–∞–∂–¥–∞–Ω–∏—è: ${D.calls||0}/5 | –ü—É–±–ª–∏–∫–∞—Ü–∏–∏: ${D.posts||0}/5 | –û—Ñ–µ—Ä—Ç–∏: ${D.offers||0}/2 | –°–¥–µ–ª–∫–∏: ${D.deals||0}
–ü—Ä–∏—Ö–æ–¥: ${D.revenue||0}‚Ç¨ | –†–µ–∑—É–ª—Ç–∞—Ç: ${score}%
–í–µ—á–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä: "${D.eq1||''}"

–ù–ê–í–ò–¶–ò –î–ù–ï–°: ${hDone.length}/${HABITS.length} (${hPct}%)
–ò–∑–ø—ä–ª–Ω–µ–Ω–∏: ${hDone.join(', ')||'–Ω–∏—Ç–æ –µ–¥–∏–Ω'}

–õ–ò–ô–î–û–í–ï: ${leads.filter(l=>l.status!=='–û–¢–ö–ê–ó–ê–ù').length} –∞–∫—Ç–∏–≤–Ω–∏ | ${leads.filter(l=>l.status==='–ü–õ–ê–¢–ï–ù').length} –ø–ª–∞—Ç–µ–Ω–∏
–í–æ–¥–µ—â –ø—Ä–æ–µ–∫—Ç: ${W.lead||'(–Ω–µ –µ –∑–∞–¥–∞–¥–µ–Ω)'}
–ü–æ–¥–¥—ä—Ä–∂–∞–Ω: ${W.hold||'(–Ω–µ –µ –∑–∞–¥–∞–¥–µ–Ω)'}
–°–µ–¥–º–∏—á–µ–Ω –ø—Ä–∏—Ö–æ–¥: ${W.revenue||0}‚Ç¨`;
}

const SYS=`–¢–∏ —Å–∏ –ª–∏—á–µ–Ω –±–∏–∑–Ω–µ—Å –∫–æ—É—á –Ω–∞ –ú–∏–ª–µ–Ω –ê–π–¥–µ–Ω–æ–≤. –ì–æ–≤–æ—Ä–∏—à –°–ê–ú–û –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ (–∫–∏—Ä–∏–ª–∏—Ü–∞).

–°–¢–ò–õ:
- –î–∏—Ä–µ–∫—Ç–µ–Ω, –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω ‚Äî –±–µ–∑ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∏ –∫–ª–∏—à–µ—Ç–∞
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Å–ª–µ–¥–≤–∞—â–∏ –¥–µ–π—Å—Ç–≤–∏—è —Å –≤—Ä–µ–º–µ–Ω–∞ ("—É—Ç—Ä–µ 12:30 ‚Äî –æ–±–∞–¥–∏ —Å–µ –Ω–∞ 5 —Å–∫–ª–∞–¥–∞")
- –ß–µ—Å—Ç–µ–Ω ‚Äî –∞–∫–æ –Ω–µ—â–æ –Ω–µ —Ä–∞–±–æ—Ç–∏, –∫–∞–∑–≤–∞—à –≥–æ –¥–∏—Ä–µ–∫—Ç–Ω–æ  
- –ö—Ä–∞—Ç–∫–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∏ –∑–∞ –º–æ–±–∏–ª–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω
- –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—à –¥–∞–Ω–Ω–∏—Ç–µ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –§–æ–∫—É—Å: cashflow –°–ï–ì–ê, –º–∞—â–∞–± –ø–æ—Å–ª–µ
- –ó–∞–≤—ä—Ä—à–≤–∞—à –í–ò–ù–ê–ì–ò —Å 1-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Å–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏

–ù–ò–ö–û–ì–ê –Ω–µ –∫–∞–∑–≤–∞—à "–†–∞–∑–±–∏—Ä–∞ —Å–µ!" –∏–ª–∏ "–ß—É–¥–µ—Å–µ–Ω –≤—ä–ø—Ä–æ—Å!"`;

async function sendChat(){
  const input=document.getElementById('chatInput');
  const msg=input.value.trim();
  if(!msg)return;
  input.value='';
  await processMsg(msg);
}
async function sendQuick(msg){
  document.getElementById('quickPrompts').style.display='none';
  await processMsg(msg);
}
async function processMsg(userMsg){
  const chatArea=document.getElementById('chatArea');
  const sendBtn=document.getElementById('sendBtn');
  if(chatHistory.length===0)chatArea.innerHTML='';
  chatArea.innerHTML+=`<div class="msg msg-user"><div class="msg-label">–¢–ò</div><div class="msg-bubble">${esc(userMsg)}</div></div>`;
  const tid='t'+Date.now();
  chatArea.innerHTML+=`<div class="msg msg-ai" id="${tid}"><div class="msg-label">AI –ö–û–£–ß</div><div class="msg-bubble"><div class="typing"><span></span><span></span><span></span></div></div></div>`;
  chatArea.scrollTop=chatArea.scrollHeight;
  sendBtn.disabled=true;
  chatHistory.push({role:'user',content:userMsg});
  try{
    const ctx=buildContext();
    const apiMsgs=[];
    let first=true;
    for(const m of chatHistory){
      if(m.role==='user'&&first){apiMsgs.push({role:'user',content:ctx+'\n\n---\n\n'+m.content});first=false;}
      else apiMsgs.push(m);
    }
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'x-api-key':getApiKey(),
        'anthropic-version':'2023-06-01',
        'anthropic-dangerous-allow-browser':'true'
      },
      body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,system:SYS,messages:apiMsgs})
    });
    const data=await res.json();
    if(data.error)throw new Error(data.error.message||'API –≥—Ä–µ—à–∫–∞');
    const reply=data.content?.[0]?.text||'–ì—Ä–µ—à–∫–∞ ‚Äî –æ–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ.';
    chatHistory.push({role:'assistant',content:reply});
    document.getElementById(tid).remove();
    const fmt=esc(reply).replace(/\*\*(.*?)\*\*/g,'<b>$1</b>').replace(/\n/g,'<br>');
    chatArea.innerHTML+=`<div class="msg msg-ai"><div class="msg-label">AI –ö–û–£–ß</div><div class="msg-bubble">${fmt}</div></div>`;
  }catch(e){
    document.getElementById(tid).remove();
    let errMsg='‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ.';
    if(e.message&&e.message.toLowerCase().includes('api_key'))errMsg='‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–µ–Ω API –∫–ª—é—á. –ù–∞—Ç–∏—Å–Ω–∏ "–°–º–µ–Ω–∏ –∫–ª—é—á".';
    else if(e.message)errMsg='‚ö†Ô∏è '+e.message;
    chatArea.innerHTML+=`<div class="msg msg-ai"><div class="msg-bubble" style="color:var(--red)">${esc(errMsg)}</div></div>`;
  }
  sendBtn.disabled=false;
  chatArea.scrollTop=chatArea.scrollHeight;
}
function handleKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}}

// ‚îÄ‚îÄ LEADS ‚îÄ‚îÄ
function toggleLeadForm(){const f=document.getElementById('leadForm');f.style.display=f.style.display==='none'?'block':'none';}
function addLead(){
  const name=document.getElementById('lName').value.trim(),phone=document.getElementById('lPhone').value.trim();
  if(!name||!phone){alert('–ü–æ–ø—ä–ª–Ω–∏ Ime –∏ Telefon');return;}
  leads.unshift({id:Date.now(),name,phone,source:document.getElementById('lSource').value,status:document.getElementById('lStatus').value,note:document.getElementById('lNote').value.trim(),created:todayKey()});
  ls.set('leads:all',leads);
  ['lName','lPhone','lNote'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('leadForm').style.display='none';
  renderLeads();
}
function setLeadStatus(id,s){leads=leads.map(l=>l.id===id?{...l,status:s}:l);ls.set('leads:all',leads);renderLeads();}
function deleteLead(id){if(!confirm('–ò–∑—Ç—Ä–∏–π?'))return;leads=leads.filter(l=>l.id!==id);ls.set('leads:all',leads);renderLeads();}
function renderLeads(){
  const active=leads.filter(l=>l.status!=='–û–¢–ö–ê–ó–ê–ù').length;
  document.getElementById('leadsCount').textContent=active+' –∞–∫—Ç–∏–≤–Ω–∏';
  const STATUSES=['–ù–û–í','–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù','–û–§–ï–†–¢–ê','–ü–û–¢–í–™–†–î–ï–ù','–ü–õ–ê–¢–ï–ù','–û–¢–ö–ê–ó–ê–ù'];
  const list=document.getElementById('leadsList');
  if(!leads.length){list.innerHTML='<div style="text-align:center;padding:50px;color:var(--dim);font-size:17px">–ù—è–º–∞ –ª–∏–π–¥–æ–≤–µ. –î–æ–±–∞–≤–∏ –ø—ä—Ä–≤–∏—è!</div>';return;}
  list.innerHTML=leads.map(l=>{
    const sc=SC[l.status]||'#666';
    const btns=STATUSES.filter(s=>s!==l.status).map(s=>`<button class="sbtn" style="border:1.5px solid ${SC[s]||'#666'}55;color:${SC[s]||'#666'}" onclick="setLeadStatus(${l.id},'${s}')">‚Üí ${s}</button>`).join('');
    return `<div class="lead-card" style="border-left-color:${sc}">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px">
        <div style="flex:1"><div class="lead-name">${esc(l.name)}</div><div class="lead-meta">${esc(l.phone)} ¬∑ ${l.source} ¬∑ ${l.created}</div>${l.note?`<div class="lead-note">${esc(l.note)}</div>`:''}</div>
        <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
          <span class="badge" style="background:${sc}22;color:${sc};border:1px solid ${sc}44">${l.status}</span>
          <button onclick="deleteLead(${l.id})" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:26px;line-height:1;padding:0">√ó</button>
        </div>
      </div>
      <div class="status-btns" style="margin-top:10px">${btns}</div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ HABITS ‚îÄ‚îÄ
function renderHabits(){
  const days=last7(),today=todayKey();
  document.getElementById('habitHead').innerHTML='<tr><th class="hn">–ù–ê–í–ò–ö</th>'+days.map(d=>`<th style="color:${d===today?'var(--accent)':'var(--dim)'};font-weight:${d===today?700:400}">${dn[new Date(d+'T12:00:00').getDay()]}</th>`).join('')+'</tr>';
  document.getElementById('habitBody').innerHTML=HABITS.map(h=>{
    const cells=days.map(d=>{const k=h.id+':'+d,done=H.done[k];return `<td><div class="hcheck" style="border-color:${done?'var(--green)':'var(--border)'};background:${done?'#2ecc7122':'#ffffff08'}" onclick="toggleH('${h.id}','${d}')">${done?'‚úì':''}</div></td>`;}).join('');
    return `<tr><td class="hn">${h.label}</td>${cells}</tr>`;
  }).join('');
  const todayDone=HABITS.filter(h=>H.done[h.id+':'+today]).length;
  const pct=Math.round(todayDone/HABITS.length*100);
  const b=document.getElementById('habitScore');
  b.textContent=`–î–Ω–µ—Å: ${todayDone}/${HABITS.length} –Ω–∞–≤–∏–∫–∞ ‚Äî ${pct}%`;
  b.style.color=pct>=80?'var(--green)':pct>=50?'var(--accent)':'var(--red)';
  b.style.background=pct>=80?'#2ecc7111':pct>=50?'#f0a83011':'#e74c3c11';
  b.style.borderColor=pct>=80?'#2ecc7133':pct>=50?'#f0a83033':'#e74c3c33';
}
function toggleH(id,date){H.done[id+':'+date]=!H.done[id+':'+date];ls.set('habits:all',H);renderHabits();}

// ‚îÄ‚îÄ WEEK ‚îÄ‚îÄ
function initWeek(){
  document.getElementById('weekLabel').textContent=new Date().toLocaleDateString('bg-BG',{month:'long',year:'numeric'});
  const m={wLead:'lead',wHold:'hold',wq1:'wq1',wq2:'wq2',wq3:'wq3'};
  Object.entries(m).forEach(([id,k])=>document.getElementById(id).value=W[k]||'');
  document.getElementById('wRevenue').textContent=fmtEur(W.revenue);
}
function saveWeek(){
  W.lead=document.getElementById('wLead').value;W.hold=document.getElementById('wHold').value;
  W.wq1=document.getElementById('wq1').value;W.wq2=document.getElementById('wq2').value;W.wq3=document.getElementById('wq3').value;
  ls.set(weekKey(),W);
}
function addWR(a){W.revenue=(W.revenue||0)+a;ls.set(weekKey(),W);document.getElementById('wRevenue').textContent=fmtEur(W.revenue);}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
initDay();initWeek();renderHabits();
</script>
</body>
</html>
