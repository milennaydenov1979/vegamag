<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>VEGAMAG</title>
<style>
:root{
  --bg:#09090f;--surface:#111119;--card:#16161f;--border:#22223a;
  --accent:#f0a830;--green:#2ecc71;--red:#e74c3c;
  --blue:#5ba4f5;--purple:#b07ef8;--dim:#5a5a80;
  --text:#e8e8f4;--text2:#9090b8;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:'Courier New',monospace;font-size:17px;min-height:100vh;padding-bottom:90px;-webkit-font-smoothing:antialiased;}
.topbar{background:var(--bg);border-bottom:1px solid var(--border);padding:16px 18px 12px;position:sticky;top:0;z-index:50;display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:21px;font-weight:900;color:var(--accent);letter-spacing:3px;}
.logo-sub{font-size:10px;color:var(--dim);letter-spacing:2px;margin-top:2px;}
.score-label{font-size:10px;color:var(--dim);letter-spacing:1px;text-align:right;}
.score-val{font-size:33px;font-weight:900;font-family:monospace;text-align:right;line-height:1;}
.nav{position:fixed;bottom:0;left:0;right:0;background:#0c0c14;border-top:1px solid var(--border);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom);}
.nav-btn{flex:1;padding:10px 2px 8px;background:none;border:none;color:var(--dim);font-family:inherit;font-size:10px;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:3px;}
.nav-btn .icon{font-size:22px;}
.nav-btn.active{color:var(--accent);}
.view{display:none;padding:16px;max-width:600px;margin:0 auto;}
.view.active{display:block;}
.card{background:var(--surface);border:1.5px solid var(--border);border-radius:16px;padding:16px;margin-bottom:14px;}
.field{margin-bottom:14px;}
.field label{font-size:14px;color:var(--text2);display:block;margin-bottom:7px;line-height:1.4;}
input,textarea,select{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:16px;padding:12px 14px;outline:none;-webkit-appearance:none;appearance:none;}
input:focus,textarea:focus{border-color:var(--accent);}
textarea{min-height:78px;resize:vertical;line-height:1.5;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn{display:block;width:100%;background:var(--accent);color:#000;border:2px solid var(--accent);border-radius:12px;padding:14px;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;margin-top:12px;text-align:center;}
.btn:active{opacity:0.75;}
.btn.purple{background:var(--purple);border-color:var(--purple);color:#000;}
.btn.sm{width:auto;padding:9px 18px;font-size:14px;margin-top:0;}
.counters{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.counter{background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:14px 12px;}
.counter-label{font-size:12px;color:var(--dim);letter-spacing:0.5px;margin-bottom:10px;font-weight:700;}
.counter-row{display:flex;align-items:center;gap:6px;}
.cnt-btn{width:38px;height:38px;border-radius:50%;flex-shrink:0;border:1.5px solid var(--border);background:#ffffff11;color:var(--text);font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.counter-val{font-size:32px;font-weight:900;font-family:monospace;flex:1;text-align:center;}
.pb{height:5px;background:var(--border);border-radius:3px;margin-top:10px;overflow:hidden;}
.pbf{height:100%;border-radius:3px;transition:width 0.4s;}
.rev-box{background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:16px;margin-top:12px;}
.rev-lbl{font-size:11px;color:var(--dim);letter-spacing:1px;}
.rev-val{font-size:36px;font-weight:900;color:var(--green);font-family:monospace;margin:4px 0 12px;}
.qbtns{display:flex;gap:8px;flex-wrap:wrap;}
.qbtn{background:#2ecc7122;border:1.5px solid #2ecc7133;color:var(--green);border-radius:8px;padding:9px 14px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;}
.banner{border-radius:10px;padding:12px 14px;font-size:14px;margin-bottom:12px;line-height:1.5;}
.banner.green{background:#2ecc7111;border:1px solid #2ecc7133;color:var(--green);}
.banner.accent{background:#f0a83011;border:1px solid #f0a83033;color:var(--accent);}
.banner.dim{background:var(--card);border:1px solid var(--border);color:var(--text2);font-size:13px;}
.mit-box{background:#f0a83011;border:1.5px solid #f0a83033;border-radius:14px;padding:14px;margin-bottom:14px;}
.mit-lbl{font-size:11px;color:var(--accent);letter-spacing:1px;margin-bottom:6px;}
.mit-txt{font-size:17px;color:var(--text);font-weight:700;line-height:1.4;}
.habit-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;}
.habit-table{width:100%;border-collapse:collapse;min-width:300px;}
.habit-table th{font-size:12px;color:var(--dim);padding:6px 3px;text-align:center;}
.habit-table th.hn{text-align:left;min-width:130px;}
.habit-table td{padding:8px 3px;border-top:1px solid var(--border);}
.habit-table td.hn{font-size:15px;padding-right:10px;}
.hcheck{width:34px;height:34px;border-radius:8px;margin:0 auto;border:2px solid var(--border);background:#ffffff08;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:17px;}
.lead-card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:10px;border-left:3px solid var(--dim);}
.lead-name{font-size:18px;font-weight:700;}
.lead-meta{font-size:14px;color:var(--dim);margin:3px 0 6px;}
.lead-note{font-size:14px;color:var(--text2);margin-bottom:10px;line-height:1.4;}
.status-btns{display:flex;gap:6px;flex-wrap:wrap;}
.sbtn{border-radius:5px;padding:6px 10px;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;background:transparent;}
.badge{display:inline-block;border-radius:5px;padding:3px 9px;font-size:12px;font-weight:700;}
.page-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.page-title{font-size:24px;font-weight:900;}
.page-sub{font-size:14px;color:var(--dim);margin-top:2px;}
.stat-big{font-size:36px;font-weight:900;font-family:monospace;}

/* ‚îÄ‚îÄ AI SETUP ‚îÄ‚îÄ */
.setup-card{background:var(--card);border:2px solid var(--purple);border-radius:18px;padding:20px;margin-bottom:14px;}
.setup-title{font-size:20px;font-weight:900;color:var(--purple);margin-bottom:10px;}
.setup-intro{font-size:15px;color:var(--text2);line-height:1.6;margin-bottom:16px;}
.step{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px;padding:12px;background:var(--surface);border-radius:12px;}
.step-n{width:32px;height:32px;border-radius:50%;background:var(--accent);color:#000;font-weight:900;font-size:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.step-t{font-size:15px;color:var(--text);line-height:1.6;}
.step-t b{color:var(--accent);}
.step-t code{background:#22223a;border-radius:5px;padding:2px 8px;font-size:13px;color:var(--blue);font-family:'Courier New',monospace;}
.url-row{display:flex;gap:8px;margin-top:4px;}
.url-row input{flex:1;font-size:14px;}
.url-save{background:var(--purple);border:none;color:#fff;border-radius:10px;padding:14px 18px;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;flex-shrink:0;}
.url-ok{background:#2ecc7111;border:1px solid #2ecc7133;color:var(--green);border-radius:10px;padding:12px;font-size:15px;font-weight:700;display:none;margin-top:10px;text-align:center;}

/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
.ai-bar{background:var(--card);border:1.5px solid var(--purple);border-radius:14px;padding:13px 16px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center;}
.ai-bar-t{font-size:16px;font-weight:900;color:var(--purple);}
.ai-bar-s{font-size:13px;color:var(--text2);margin-top:2px;}
.change-btn{background:none;border:1.5px solid var(--border);color:var(--dim);border-radius:8px;padding:8px 14px;font-family:inherit;font-size:13px;cursor:pointer;}
.chat-area{background:var(--card);border:1.5px solid var(--border);border-radius:16px;padding:14px;min-height:200px;margin-bottom:12px;max-height:46vh;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.msg{margin-bottom:14px;animation:fi 0.2s ease;}
@keyframes fi{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg-user{text-align:right;}
.bubble{display:inline-block;max-width:90%;border-radius:14px;padding:12px 15px;font-size:15px;line-height:1.6;text-align:left;}
.msg-user .bubble{background:var(--accent);color:#000;font-weight:600;}
.msg-ai .bubble{background:#1e1e30;color:var(--text);border:1px solid var(--border);}
.msg-ai .bubble b{color:var(--accent);}
.msg-lbl{font-size:11px;color:var(--dim);margin-bottom:4px;letter-spacing:0.5px;}
.typing{display:flex;gap:5px;padding:4px 0;}
.typing span{width:8px;height:8px;border-radius:50%;background:var(--purple);animation:bl 1.2s infinite;}
.typing span:nth-child(2){animation-delay:.2s;}
.typing span:nth-child(3){animation-delay:.4s;}
@keyframes bl{0%,80%,100%{opacity:.2}40%{opacity:1}}
.chat-row{display:flex;gap:8px;}
.chat-row textarea{flex:1;min-height:52px;font-size:16px;padding:12px;}
.send-btn{width:52px;height:52px;border-radius:12px;flex-shrink:0;background:var(--purple);border:none;color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;align-self:flex-end;}
.send-btn:disabled{opacity:0.3;}
.qps{display:flex;flex-direction:column;gap:8px;margin-bottom:12px;}
.qp{background:var(--surface);border:1.5px solid var(--border);border-radius:12px;padding:13px 15px;font-family:inherit;font-size:15px;color:var(--text);cursor:pointer;text-align:left;line-height:1.4;}
.qp:active{border-color:var(--purple);}
</style>
</head>
<body>

<div class="topbar">
  <div><div class="logo">VEGAMAG</div><div class="logo-sub">COMMAND CENTER</div></div>
  <div><div class="score-label">–†–ï–ó–£–õ–¢–ê–¢ –î–ù–ï–°</div><div class="score-val" id="topScore" style="color:var(--accent)">0%</div></div>
</div>

<!-- –î–ù–ï–° -->
<div id="view-day" class="view active">
  <div class="page-row">
    <div><div class="page-title">–î–ù–ï–° ‚ö°</div><div class="page-sub" id="todayDate"></div></div>
  </div>
  <div class="mit-box" id="mitDisplay" style="display:none">
    <div class="mit-lbl">üéØ –î–ù–ï–®–ù–ò–Ø–¢ MIT:</div>
    <div class="mit-txt" id="mitText"></div>
  </div>
  <div class="card" id="morningCard">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:14px;color:var(--accent)">üåÖ –°–£–¢–†–ï–®–ï–ù –ü–†–û–¢–û–ö–û–õ</div>
    <div id="mDoneBanner" class="banner green" style="display:none">‚úì –°—É—Ç—Ä–∏–Ω—Ç–∞ –µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ ‚Äî –¥–µ–π—Å—Ç–≤–∞–π!</div>
    <div class="field"><label>üéØ MIT ‚Äî –ï–¥–Ω–æ—Ç–æ –Ω–µ—â–æ, –∫–æ–µ—Ç–æ –∞–∫–æ –Ω–∞–ø—Ä–∞–≤—è –≤—Å–∏—á–∫–æ –¥—Ä—É–≥–æ –µ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ:</label><input type="text" id="mit" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –∏–∑–º–µ—Ä–∏–º–æ..." oninput="saveDay()"></div>
    <div class="field"><label>‚ö° –ë–ª–æ–∫–µ—Ä ‚Äî –ö–æ–µ –º–æ–∂–µ –¥–∞ –º–µ —Å–ø—Ä–µ –∏ –∫–∞–∫ —â–µ –≥–æ –ø—Ä–µ–æ–¥–æ–ª–µ—è:</label><input type="text" id="blocker" placeholder="–ß–µ—Å—Ç–Ω–æ..." oninput="saveDay()"></div>
    <div class="field"><label>üö´ –ù–ï ‚Äî –û—Ç –∫–∞–∫–≤–æ —â–µ –∫–∞–∂–∞ –ù–ï –¥–Ω–µ—Å:</label><input type="text" id="noToday" placeholder="–ö–æ–µ —â–µ –∏–≥–Ω–æ—Ä–∏—Ä–∞–º..." oninput="saveDay()"></div>
    <button class="btn" id="mDoneBtn" onclick="markMorningDone()">‚úì –°—É—Ç—Ä–∏–Ω—Ç–∞ –µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</button>
  </div>
  <div class="card">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:10px;color:var(--blue)">üìä –î–ù–ï–í–ù–ò –î–ï–ô–°–¢–í–ò–Ø</div>
    <div style="font-size:14px;color:var(--dim);margin-bottom:14px">–¶–ï–õ: 5 –æ–±–∞–∂–¥–∞–Ω–∏—è ¬∑ 5 –ø–æ—Å—Ç–∞ ¬∑ 2 –æ—Ñ–µ—Ä—Ç–∏ ¬∑ 1 —Å–¥–µ–ª–∫–∞</div>
    <div class="counters">
      <div class="counter">
        <div class="counter-label" style="color:var(--blue)">üìû –û–ë–ê–ñ–î–ê–ù–ò–Ø</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('calls',-1)">‚àí</button>
          <div class="counter-val" id="calls-val" style="color:var(--blue)">0</div>
          <button class="cnt-btn" style="border-color:var(--blue);background:#5ba4f522;color:var(--blue)" onclick="adj('calls',1)">+</button>
        </div>
        <div class="pb"><div class="pbf" id="calls-bar" style="background:var(--blue);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--accent)">üìù –ü–£–ë–õ–ò–ö–ê–¶–ò–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('posts',-1)">‚àí</button>
          <div class="counter-val" id="posts-val" style="color:var(--accent)">0</div>
          <button class="cnt-btn" style="border-color:var(--accent);background:#f0a83022;color:var(--accent)" onclick="adj('posts',1)">+</button>
        </div>
        <div class="pb"><div class="pbf" id="posts-bar" style="background:var(--accent);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--purple)">üí¨ –û–§–ï–†–¢–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('offers',-1)">‚àí</button>
          <div class="counter-val" id="offers-val" style="color:var(--purple)">0</div>
          <button class="cnt-btn" style="border-color:var(--purple);background:#b07ef822;color:var(--purple)" onclick="adj('offers',1)">+</button>
        </div>
        <div class="pb"><div class="pbf" id="offers-bar" style="background:var(--purple);width:0%"></div></div>
      </div>
      <div class="counter">
        <div class="counter-label" style="color:var(--green)">‚úÖ –°–î–ï–õ–ö–ò</div>
        <div class="counter-row">
          <button class="cnt-btn" onclick="adj('deals',-1)">‚àí</button>
          <div class="counter-val" id="deals-val" style="color:var(--green)">0</div>
          <button class="cnt-btn" style="border-color:var(--green);background:#2ecc7122;color:var(--green)" onclick="adj('deals',1)">+</button>
        </div>
        <div class="pb"><div class="pbf" id="deals-bar" style="background:var(--green);width:0%"></div></div>
      </div>
    </div>
    <div class="rev-box">
      <div class="rev-lbl">üí∂ –ü–†–ò–•–û–î –î–ù–ï–°</div>
      <div class="rev-val" id="rev-val">0 ‚Ç¨</div>
      <div class="qbtns">
        <button class="qbtn" onclick="addRev(50)">+50‚Ç¨</button>
        <button class="qbtn" onclick="addRev(80)">+80‚Ç¨</button>
        <button class="qbtn" onclick="addRev(120)">+120‚Ç¨</button>
        <button class="qbtn" onclick="addRev(200)">+200‚Ç¨</button>
        <button class="qbtn" onclick="addRevCustom()">+–¥—Ä—É–≥–æ</button>
      </div>
    </div>
  </div>
  <div class="card" id="eveningCard">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:14px;color:var(--purple)">üåô –í–ï–ß–ï–†–ï–ù –ü–†–ï–ì–õ–ï–î</div>
    <div id="eDoneBanner" class="banner green" style="display:none">‚úì –î–µ–Ω—è—Ç –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω ‚Äî —É—Ç—Ä–µ –æ—Ç–Ω–æ–≤–æ!</div>
    <div class="field"><label>–ù–∞–ø—Ä–∞–≤–∏—Ö –ª–∏ MIT-–∞? –ê–∫–æ –Ω–µ ‚Äî –∑–∞—â–æ —Ç–æ—á–Ω–æ?</label><textarea id="eq1" placeholder="–ß–µ—Å—Ç–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä..." oninput="saveDay()"></textarea></div>
    <div class="field"><label>–ö–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–æ–±–ª–∏–∂–∏ –º–µ–Ω –∏ —Å–µ–º–µ–π—Å—Ç–≤–æ—Ç–æ –º–∏ –¥–æ —Å—Ç–∞–±–∏–ª–Ω–æ—Å—Ç?</label><textarea id="eq2" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ..." oninput="saveDay()"></textarea></div>
    <div class="field"><label>–ï–¥–Ω–æ –Ω–µ—â–æ –∫–æ–µ—Ç–æ —É—Ç—Ä–µ —â–µ –Ω–∞–ø—Ä–∞–≤—è —Ä–∞–∑–ª–∏—á–Ω–æ:</label><textarea id="eq3" placeholder="–°–∞–º–æ 1 –Ω–µ—â–æ..." oninput="saveDay()"></textarea></div>
    <button class="btn purple" id="eDoneBtn" onclick="markEveningDone()">‚úì –î–µ–Ω—è—Ç –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω</button>
  </div>
  <div class="card">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:10px;color:var(--dim)">üìå –ë–™–†–ó–ê –ë–ï–õ–ï–ñ–ö–ê</div>
    <textarea id="dayNote" placeholder="–ù–µ—â–æ –≤–∞–∂–Ω–æ –¥–∞ –Ω–µ –∑–∞–±—Ä–∞–≤–∏—à..." oninput="saveDay()"></textarea>
  </div>
</div>

<!-- AI –ö–û–£–ß -->
<div id="view-ai" class="view">
  <div class="page-row">
    <div><div class="page-title">AI –ö–û–£–ß ü§ñ</div><div class="page-sub" id="aiSub">...</div></div>
  </div>

  <!-- SETUP -->
  <div id="setupSection">
    <div class="setup-card">
      <div class="setup-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ‚Äî 5 –º–∏–Ω—É—Ç–∏</div>
      <div class="setup-intro">–ò–∑–ø–æ–ª–∑–≤–∞–º–µ Google Apps Script –∫–∞—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫. –ò–º–∞—à Google –∞–∫–∞—É–Ω—Ç ‚Üí –∏–º–∞—à –≤—Å–∏—á–∫–æ –Ω—É–∂–Ω–æ. –ë–µ–∑–ø–ª–∞—Ç–Ω–æ, –≤–µ–¥–Ω—ä–∂.</div>

      <div class="step">
        <div class="step-n">1</div>
        <div class="step-t">–û—Ç–≤–æ—Ä–∏ <b>script.google.com</b> ‚Üí "New project"</div>
      </div>
      <div class="step">
        <div class="step-n">2</div>
        <div class="step-t">–ò–∑—Ç—Ä–∏–π –∫–æ–¥–∞ –≤—ä—Ç—Ä–µ. –ö–æ–ø–∏—Ä–∞–π –∫–æ–¥–∞ –æ—Ç —Ñ–∞–π–ª–∞ <b>PROXY_CODE.txt</b> –∏ –≥–æ –ø–æ—Å—Ç–∞–≤–∏. –°–º–µ–Ω–∏ <code>–ü–û–°–¢–ê–í–ò_–ö–õ–Æ–ß–ê_–¢–£–ö</code> —Å –∫–ª—é—á–∞ –æ—Ç <b>console.anthropic.com</b></div>
      </div>
      <div class="step">
        <div class="step-n">3</div>
        <div class="step-t">–ù–∞—Ç–∏—Å–Ω–∏ <b>Deploy ‚Üí New deployment ‚Üí Web app</b><br>
          "Execute as": <b>Me</b><br>
          "Who has access": <b>Anyone</b><br>
          ‚Üí <b>Deploy</b> ‚Üí –∫–æ–ø–∏—Ä–∞–π URL-–∞</div>
      </div>
      <div class="step">
        <div class="step-n">4</div>
        <div class="step-t">–ü–æ—Å—Ç–∞–≤–∏ URL-–∞ —Ç—É–∫:</div>
      </div>

      <div class="url-row">
        <input type="url" id="proxyUrl" placeholder="https://script.google.com/macros/s/.../exec">
        <button class="url-save" onclick="saveProxy()">üíæ –ó–∞–ø–∞–∑–∏</button>
      </div>
      <div class="url-ok" id="urlOk">‚úÖ –ì–æ—Ç–æ–≤–æ! AI –ö–æ—É—á—ä—Ç –µ –∞–∫—Ç–∏–≤–µ–Ω.</div>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chatSection" style="display:none">
    <div class="ai-bar">
      <div>
        <div class="ai-bar-t">ü§ñ AI –ö–æ—É—á ‚Äî –∞–∫—Ç–∏–≤–µ–Ω</div>
        <div class="ai-bar-s">–ó–Ω–∞–µ –∑–∞ Vegamag, –Ω–∞–≤–∏—Ü–∏—Ç–µ –∏ —Ü–µ–ª–∏—Ç–µ —Ç–∏</div>
      </div>
      <button class="change-btn" onclick="resetProxy()">‚öôÔ∏è –ü—Ä–æ–º–µ–Ω–∏</button>
    </div>

    <div class="qps" id="qps">
      <button class="qp" onclick="ask('–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –º–æ—è –¥–µ–Ω –¥–Ω–µ—Å ‚Äî –∫–∞–∫–≤–æ –Ω–∞–ø—Ä–∞–≤–∏—Ö –¥–æ–±—Ä–µ –∏ –∫–∞–∫–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–¥–æ–±—Ä—è —É—Ç—Ä–µ?')">üìä –ê–Ω–∞–ª–∏–∑ –Ω–∞ –¥–Ω–µ—à–Ω–∏—è –¥–µ–Ω</button>
      <button class="qp" onclick="ask('–ö–æ–∏ —Å–∞ 3-—Ç–µ –Ω–∞–π-–≤–∞–∂–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –∑–∞ –ø–æ–≤–µ—á–µ –ø—Ä–∏—Ö–æ–¥ –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–ª–µ–¥ 17:30?')">üí∂ –ö–∞–∫ –¥–∞ —É–≤–µ–ª–∏—á–∞ –ø—Ä–∏—Ö–æ–¥–∞?</button>
      <button class="qp" onclick="ask('–û—Ü–µ–Ω–∏ –º–æ–∏—Ç–µ –Ω–∞–≤–∏—Ü–∏ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –∏ –∫–∞–∂–∏ —á–µ—Å—Ç–Ω–æ –∫–æ–µ –º–µ —Å–ø–∏—Ä–∞ –æ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç.')">üî• –ö–æ–π –Ω–∞–≤–∏–∫ –º–µ —Å–ø–∏—Ä–∞?</button>
      <button class="qp" onclick="ask('–î–∞–π –º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω 30-–¥–Ω–µ–≤–µ–Ω –ø–ª–∞–Ω –∑–∞ 3000‚Ç¨ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ –æ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏—è –±–∏–∑–Ω–µ—Å —Å–ª–µ–¥ 17:30.')">üöÄ 30-–¥–Ω–µ–≤–µ–Ω –ø–ª–∞–Ω –∑–∞ 3000‚Ç¨</button>
      <button class="qp" onclick="ask('–ö–∞–∫ –¥–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–∞–º SmartBooks.bg –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏—è –±–∏–∑–Ω–µ—Å? –ö–æ–π –µ –≤–æ–¥–µ—â –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –°–ï–ì–ê?')">‚öñÔ∏è SmartBooks vs –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç?</button>
      <button class="qp" onclick="ask('–ö–∞–∫–≤–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Ç–µ–∫—Å—Ç–æ–≤–µ –¥–∞ –ø—É–±–ª–∏–∫—É–≤–∞–º –≤ FB –≥—Ä—É–ø–∏ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏ –∑–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç?')">üì± –¢–µ–∫—Å—Ç–æ–≤–µ –∑–∞ FB –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</button>
    </div>

    <div class="chat-area" id="chatArea">
      <div style="color:var(--dim);font-size:15px;text-align:center;padding:30px 10px">–ò–∑–±–µ—Ä–∏ –≤—ä–ø—Ä–æ—Å –≥–æ—Ä–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π ‚Üì</div>
    </div>

    <div class="chat-row">
      <textarea id="chatInput" placeholder="–ü–∏—Ç–∞–π –∑–∞ –±–∏–∑–Ω–µ—Å, –Ω–∞–≤–∏—Ü–∏, –ø–∞—Ä–∏..." onkeydown="onKey(event)"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMsg()">‚û§</button>
    </div>
  </div>
</div>

<!-- –õ–ò–ô–î–û–í–ï -->
<div id="view-leads" class="view">
  <div class="page-row">
    <div><div class="page-title">–õ–ò–ô–î–û–í–ï üë•</div><div class="page-sub" id="leadsCount">0 –∞–∫—Ç–∏–≤–Ω–∏</div></div>
    <button class="btn sm" onclick="toggleLF()">+ –ù–û–í</button>
  </div>
  <div class="card" id="leadForm" style="display:none">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:14px;color:var(--accent)">–ù–û–í –õ–ò–ô–î</div>
    <div class="grid2">
      <div class="field"><label>–ò–º–µ</label><input type="text" id="lName" placeholder="–ò–≤–∞–Ω"></div>
      <div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="lPhone" placeholder="0888..."></div>
    </div>
    <div class="grid2">
      <div class="field"><label>–ò–∑—Ç–æ—á–Ω–∏–∫</label>
        <select id="lSrc"><option>FB</option><option>OLX</option><option>–ü—Ä–µ–ø–æ—Ä—ä–∫–∞</option><option>–î–∏—Ä–µ–∫—Ç–Ω–æ</option><option>–î—Ä—É–≥–æ</option></select>
      </div>
      <div class="field"><label>–°—Ç–∞—Ç—É—Å</label>
        <select id="lSt"><option>–ù–û–í</option><option>–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù</option><option>–û–§–ï–†–¢–ê</option><option>–ü–û–¢–í–™–†–î–ï–ù</option><option>–ü–õ–ê–¢–ï–ù</option></select>
      </div>
    </div>
    <div class="field"><label>–ë–µ–ª–µ–∂–∫–∞</label><textarea id="lNote" placeholder="–ö–∞–∫–≤–æ –∏—Å–∫–∞, —Ü–µ–Ω–∞, –∫–æ–≥–∞..."></textarea></div>
    <button class="btn" onclick="addLead()">–î–æ–±–∞–≤–∏</button>
  </div>
  <div id="leadsList"></div>
</div>

<!-- –ù–ê–í–ò–¶–ò -->
<div id="view-habits" class="view">
  <div class="page-row">
    <div><div class="page-title">–ù–ê–í–ò–¶–ò üî•</div><div class="page-sub">–ü–æ—Å–ª–µ–¥–Ω–∏—Ç–µ 7 –¥–Ω–∏</div></div>
  </div>
  <div class="card">
    <div id="hScore" class="banner accent" style="font-size:16px;font-weight:700;margin-bottom:14px">–î–Ω–µ—Å: 0/6</div>
    <div class="habit-scroll">
      <table class="habit-table"><thead id="hHead"></thead><tbody id="hBody"></tbody></table>
    </div>
  </div>
  <div class="card" style="font-size:15px;color:var(--text2);line-height:1.7">
    <div style="font-size:16px;font-weight:700;color:var(--text);margin-bottom:8px">–ó–∞—â–æ –Ω–∞–≤–∏—Ü–∏—Ç–µ —Å–∞ –≤—Å–∏—á–∫–æ:</div>
    –ù–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, –Ω–µ –º–æ—Ç–∏–≤–∞—Ü–∏—è ‚Äî —Å–∏—Å—Ç–µ–º–∞. –í—Å—è–∫–æ ‚úì –¥–æ–∫–∞–∑–≤–∞, —á–µ —Ç–∏ —Å–∏ —á–æ–≤–µ–∫—ä—Ç, –∫–æ–π—Ç–æ –ø—Ä–∞–≤–∏ —Ç–µ–∑–∏ –Ω–µ—â–∞. 1 —Å—Ç—ä–ø–∫–∞/–¥–µ–Ω = 365 —Å—Ç—ä–ø–∫–∏/–≥–æ–¥–∏–Ω–∞.
  </div>
</div>

<!-- –°–ï–î–ú–ò–¶–ê -->
<div id="view-week" class="view">
  <div class="page-row">
    <div><div class="page-title">–°–ï–î–ú–ò–¶–ê üìä</div><div class="page-sub" id="weekLabel"></div></div>
  </div>
  <div class="card">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:12px;color:var(--accent)">üéØ –§–û–ö–£–° –ù–ê –ü–†–û–ï–ö–¢–ò–¢–ï</div>
    <div class="banner dim">1 –í–û–î–ï–© (80%) + 1 –ü–û–î–î–™–†–ñ–ê–ù (20%). –î–≤–∞—Ç–∞ –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ = –Ω–∏—Ç–æ –µ–¥–∏–Ω –Ω–∞–ø—Ä–µ–¥.</div>
    <div class="field"><label>ü•á –í–æ–¥–µ—â –ø—Ä–æ–µ–∫—Ç (80%):</label><input type="text" id="wLead" placeholder="–Ω–∞–ø—Ä. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–ª–µ–¥ 17:30" oninput="saveWeek()"></div>
    <div class="field"><label>üîÑ –ü–æ–¥–¥—ä—Ä–∂–∞–Ω (20%):</label><input type="text" id="wHold" placeholder="–Ω–∞–ø—Ä. SmartBooks" oninput="saveWeek()"></div>
  </div>
  <div class="card">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:14px;color:var(--purple)">üß† –ú–ï–¢–ê –í–™–ü–†–û–°–ò (–Ω–µ–¥–µ–ª—è)</div>
    <div class="field"><label>–ö–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ –¥–∞–¥–µ —Ä–µ–∞–ª–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç?</label><textarea id="wq1" oninput="saveWeek()" placeholder="1-2 –Ω–µ—â–∞ —á–µ—Å—Ç–Ω–æ..."></textarea></div>
    <div class="field"><label>–ê–∫–æ –∏–º–∞—Ö —Å–∞–º–æ 3 —á–∞—Å–∞ ‚Äî –Ω–∞ –∫–∞–∫–≤–æ —â—è—Ö –¥–∞ –≥–∏ –¥–∞–º?</label><textarea id="wq2" oninput="saveWeek()" placeholder="80/20..."></textarea></div>
    <div class="field"><label>–ö–∞–∫–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –°–ü–†–ê –¥–∞ –ø—Ä–∞–≤—è?</label><textarea id="wq3" oninput="saveWeek()" placeholder="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–µ–∑ –µ—Ñ–µ–∫—Ç..."></textarea></div>
  </div>
  <div class="card">
    <div style="font-size:12px;font-weight:700;letter-spacing:1.5px;margin-bottom:10px;color:var(--green)">üí∂ –°–ï–î–ú–ò–ß–ï–ù –ü–†–ò–•–û–î</div>
    <div class="stat-big" id="wRev" style="color:var(--green)">0 ‚Ç¨</div>
    <div class="qbtns" style="margin-top:12px">
      <button class="qbtn" onclick="addWR(100)">+100‚Ç¨</button>
      <button class="qbtn" onclick="addWR(200)">+200‚Ç¨</button>
      <button class="qbtn" onclick="addWR(500)">+500‚Ç¨</button>
      <button class="qbtn" onclick="addWR(1000)">+1000‚Ç¨</button>
    </div>
  </div>
</div>

<nav class="nav">
  <button class="nav-btn active" id="nav-day" onclick="go('day')"><span class="icon">‚ö°</span>–î–ù–ï–°</button>
  <button class="nav-btn" id="nav-ai" onclick="go('ai')"><span class="icon">ü§ñ</span>AI –ö–û–£–ß</button>
  <button class="nav-btn" id="nav-leads" onclick="go('leads')"><span class="icon">üë•</span>–õ–ò–ô–î–û–í–ï</button>
  <button class="nav-btn" id="nav-habits" onclick="go('habits')"><span class="icon">üî•</span>–ù–ê–í–ò–¶–ò</button>
  <button class="nav-btn" id="nav-week" onclick="go('week')"><span class="icon">üìä</span>–°–ï–î–ú–ò–¶–ê</button>
</nav>

<script>
const S=(k,v)=>{try{localStorage.setItem('vg_'+k,JSON.stringify(v))}catch{}};
const L=(k,d)=>{try{const v=localStorage.getItem('vg_'+k);return v?JSON.parse(v):d}catch{return d}};
const SR=(k,v)=>{try{localStorage.setItem('vg_'+k,v)}catch{}};
const LR=(k)=>{try{return localStorage.getItem('vg_'+k)||''}catch{return ''}};
const $=id=>document.getElementById(id);
const esc=t=>String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const today=()=>new Date().toISOString().split('T')[0];
const wk=()=>'w'+today().slice(0,7);
const last7=()=>Array.from({length:7},(_,i)=>{const d=new Date();d.setDate(d.getDate()-(6-i));return d.toISOString().split('T')[0]});
const DN=['–ù–¥','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
const fmtE=n=>(n||0)+' ‚Ç¨';

const DK=today();
let D=L(DK,{mit:'',blocker:'',noToday:'',calls:0,posts:0,offers:0,deals:0,revenue:0,eq1:'',eq2:'',eq3:'',note:'',mDone:false,eDone:false});
let leads=L('leads',[]);
let W=L(wk(),{lead:'',hold:'',q1:'',q2:'',q3:'',rev:0});
let H=L('habits',{done:{}});
let hist=[];

const HABITS=[
  {id:'morning',label:'üåÖ –°—É—Ç—Ä–µ—à–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª'},
  {id:'mit90',label:'üéØ MIT —Ä–∞–±–æ—Ç–∞ 90+ –º–∏–Ω'},
  {id:'calls5',label:'üìû 5+ –æ–±–∞–∂–¥–∞–Ω–∏—è'},
  {id:'posts5',label:'üìù 5+ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏'},
  {id:'noscrol',label:'üö´ –ë–µ–∑ –±–µ–∑—Å–º–∏—Å–ª–µ–Ω —Å–∫—Ä–æ–ª'},
  {id:'evening',label:'üåô –í–µ—á–µ—Ä–µ–Ω –ø—Ä–µ–≥–ª–µ–¥'},
];
const SC={–ù–û–í:'#5ba4f5',–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù:'#f0a830',–û–§–ï–†–¢–ê:'#b07ef8',–ü–û–¢–í–™–†–î–ï–ù:'#2ecc71',–ü–õ–ê–¢–ï–ù:'#2ecc71',–û–¢–ö–ê–ó–ê–ù:'#e74c3c'};
const STATS=['–ù–û–í','–ö–û–ù–¢–ê–ö–¢–£–í–ê–ù','–û–§–ï–†–¢–ê','–ü–û–¢–í–™–†–î–ï–ù','–ü–õ–ê–¢–ï–ù','–û–¢–ö–ê–ó–ê–ù'];

function go(v){
  document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
  $('view-'+v).classList.add('active');
  $('nav-'+v).classList.add('active');
  if(v==='leads')renderLeads();
  if(v==='habits')renderHabits();
  if(v==='ai')initAI();
}

// DAY
function initDay(){
  $('todayDate').textContent=new Date().toLocaleDateString('bg-BG',{weekday:'long',day:'numeric',month:'long'});
  ['mit','blocker','noToday','eq1','eq2','eq3','dayNote'].forEach(id=>{
    const el=$(id);if(el)el.value=D[id==='dayNote'?'note':id]||'';
  });
  ['calls','posts','offers','deals'].forEach(f=>rC(f));
  rR();
  if(D.mDone)applyMD();
  if(D.eDone)applyED();
  rMIT();rScore();
}
function saveDay(){
  ['mit','blocker','noToday','eq1','eq2','eq3','dayNote'].forEach(id=>{
    const el=$(id);if(el)D[id==='dayNote'?'note':id]=el.value;
  });
  S(DK,D);rMIT();
}
function rMIT(){
  const b=$('mitDisplay');
  if(D.mit&&D.mDone){b.style.display='block';$('mitText').textContent=D.mit;}
  else b.style.display='none';
}
function adj(f,d){D[f]=Math.max(0,(D[f]||0)+d);S(DK,D);rC(f);rScore();}
function rC(f){
  const g={calls:5,posts:5,offers:2,deals:1},val=D[f]||0,pct=Math.min(100,Math.round(val/(g[f]||1)*100));
  $(f+'-val').textContent=val;$(f+'-bar').style.width=pct+'%';
}
function addRev(a){D.revenue=(D.revenue||0)+a;S(DK,D);rR();rScore();}
function addRevCustom(){const a=prompt('–°—É–º–∞ –≤ ‚Ç¨:');if(a&&!isNaN(a))addRev(Number(a));}
function rR(){$('rev-val').textContent=fmtE(D.revenue);}
function rScore(){
  const c=Math.min(1,(D.calls||0)/5),p=Math.min(1,(D.posts||0)/5),o=Math.min(1,(D.offers||0)/2),dl=D.deals>0?1:0;
  const s=Math.round((c+p+o+dl)/4*100);
  const el=$('topScore');el.textContent=s+'%';
  el.style.color=s>=75?'#2ecc71':s>=40?'#f0a830':'#e74c3c';
}
function markMorningDone(){D.mDone=true;S(DK,D);applyMD();rMIT();}
function applyMD(){$('mDoneBanner').style.display='block';$('mDoneBtn').style.display='none';$('morningCard').style.borderColor='#2ecc7144';}
function markEveningDone(){D.eDone=true;saveDay();applyED();}
function applyED(){$('eDoneBanner').style.display='block';$('eDoneBtn').style.display='none';$('eveningCard').style.borderColor='#2ecc7144';}

// AI
function initAI(){
  const url=LR('proxy');
  if(!url){
    $('setupSection').style.display='block';
    $('chatSection').style.display='none';
    $('aiSub').textContent='–ù—É–∂–Ω–∞ –µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞';
  }else{
    $('setupSection').style.display='none';
    $('chatSection').style.display='block';
    $('aiSub').textContent='–ê–∫—Ç–∏–≤–µ–Ω ‚úì';
  }
}
function saveProxy(){
  const url=$('proxyUrl').value.trim();
  if(!url.includes('script.google.com')&&!url.startsWith('https://')){
    alert('–ü—Ä–æ–≤–µ—Ä–∏ URL ‚Äî —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –æ—Ç Google Apps Script\n(script.google.com/macros/s/.../exec)');
    return;
  }
  SR('proxy',url);
  $('urlOk').style.display='block';
  setTimeout(()=>initAI(),1000);
}
function resetProxy(){
  SR('proxy','');hist=[];
  $('chatArea').innerHTML='<div style="color:var(--dim);font-size:15px;text-align:center;padding:30px 10px">–ò–∑–±–µ—Ä–∏ –≤—ä–ø—Ä–æ—Å –≥–æ—Ä–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π ‚Üì</div>';
  $('qps').style.display='flex';
  initAI();
}

function buildCtx(){
  const t=today();
  const hD=HABITS.filter(h=>H.done[h.id+':'+t]).map(h=>h.label);
  const sc=Math.round((Math.min(1,(D.calls||0)/5)+Math.min(1,(D.posts||0)/5)+Math.min(1,(D.offers||0)/2)+(D.deals>0?1:0))/4*100);
  return `–ö–û–ù–¢–ï–ö–°–¢ ‚Äî –ú–ò–õ–ï–ù / VEGAMAG –ï–û–û–î:
–ë–∏–∑–Ω–µ—Å: —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏ —É—Å–ª—É–≥–∏ —Å –±—É—Å —Å–ª–µ–¥ 17:30 –∏ —É–∏–∫–µ–Ω–¥ | SmartBooks.bg (AI —Å—á–µ—Ç–æ–≤–æ–¥—Å—Ç–≤–æ)
–§–∏–Ω–∞–Ω—Å–∏: ~10 000‚Ç¨ –∑–∞–¥—ä–ª–∂–µ–Ω–∏—è | –ù—É–∂–¥–∞: +2000-4000‚Ç¨/–º–µ—Å –ë–™–†–ó–û
–°–µ–º–µ–π—Å—Ç–≤–æ: —Å—ä–ø—Ä—É–≥–∞ + 3 –¥–µ—Ü–∞ | –ó–∞–ø–ª–∞—Ç–∞: ~1000‚Ç¨/–º–µ—Å

–î–ù–ï–° (${t}):
MIT: "${D.mit||'?'}" | –ë–ª–æ–∫–µ—Ä: "${D.blocker||'?'}"
–û–±–∞–∂–¥–∞–Ω–∏—è: ${D.calls||0}/5 | –ü—É–±–ª–∏–∫–∞—Ü–∏–∏: ${D.posts||0}/5 | –û—Ñ–µ—Ä—Ç–∏: ${D.offers||0}/2 | –°–¥–µ–ª–∫–∏: ${D.deals||0}
–ü—Ä–∏—Ö–æ–¥: ${D.revenue||0}‚Ç¨ | –†–µ–∑—É–ª—Ç–∞—Ç: ${sc}%
–í–µ—á–µ—Ä–µ–Ω: "${D.eq1||''}"
–ù–∞–≤–∏—Ü–∏: ${hD.length}/${HABITS.length} ‚Äî ${hD.join(', ')||'–Ω–∏—Ç–æ –µ–¥–∏–Ω'}
–í–æ–¥–µ—â: ${W.lead||'?'} | –ü–æ–¥–¥—ä—Ä–∂–∞–Ω: ${W.hold||'?'} | –°–µ–¥–º. –ø—Ä–∏—Ö–æ–¥: ${W.rev||0}‚Ç¨
–õ–∏–π–¥–æ–≤–µ: ${leads.filter(l=>l.status!=='–û–¢–ö–ê–ó–ê–ù').length} –∞–∫—Ç–∏–≤–Ω–∏`;
}

const SYS=`–¢–∏ —Å–∏ –ª–∏—á–µ–Ω –±–∏–∑–Ω–µ—Å –∫–æ—É—á –Ω–∞ –ú–∏–ª–µ–Ω –ê–π–¥–µ–Ω–æ–≤. –ì–æ–≤–æ—Ä–∏—à –°–ê–ú–û –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ (–∫–∏—Ä–∏–ª–∏—Ü–∞).
–î–∏—Ä–µ–∫—Ç–µ–Ω, –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω, –±–µ–∑ –∫–ª–∏—à–µ—Ç–∞. –î–∞–≤–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Å–ª–µ–¥–≤–∞—â–∏ –¥–µ–π—Å—Ç–≤–∏—è —Å –≤—Ä–µ–º–µ–Ω–∞.
–ö—Ä–∞—Ç–∫–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∏ –∑–∞ –º–æ–±–∏–ª–µ–Ω. –§–æ–∫—É—Å: cashflow –°–ï–ì–ê.
–ó–∞–≤—ä—Ä—à–≤–∞—à –í–ò–ù–ê–ì–ò —Å 1-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Å–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏. –ù–ò–ö–û–ì–ê –Ω–µ –∫–∞–∑–≤–∞—à "–†–∞–∑–±–∏—Ä–∞ —Å–µ!" –∏–ª–∏ "–ß—É–¥–µ—Å–µ–Ω –≤—ä–ø—Ä–æ—Å!".`;

async function ask(q){$('qps').style.display='none';await sendAI(q);}
async function sendMsg(){const i=$('chatInput'),m=i.value.trim();if(!m)return;i.value='';await sendAI(m);}

async function sendAI(userMsg){
  const ca=$('chatArea'),sb=$('sendBtn');
  if(hist.length===0)ca.innerHTML='';
  ca.innerHTML+=`<div class="msg msg-user"><div class="msg-lbl">–¢–ò</div><div class="bubble">${esc(userMsg)}</div></div>`;
  const tid='t'+Date.now();
  ca.innerHTML+=`<div class="msg msg-ai" id="${tid}"><div class="msg-lbl">AI –ö–û–£–ß</div><div class="bubble"><div class="typing"><span></span><span></span><span></span></div></div></div>`;
  ca.scrollTop=ca.scrollHeight;
  sb.disabled=true;
  hist.push({role:'user',content:userMsg});

  try{
    const msgs=hist.map((m,i)=>i===0&&m.role==='user'
      ?{role:'user',content:buildCtx()+'\n\n---\n\n–í—ä–ø—Ä–æ—Å: '+m.content}
      :m
    );

    const res=await fetch(LR('proxy'),{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-haiku-4-5-20251001',
        max_tokens:1024,
        system:SYS,
        messages:msgs
      })
    });

    const data=await res.json();
    if(data.error)throw new Error(data.error.message);

    const reply=data.content?.[0]?.text||'–ì—Ä–µ—à–∫–∞.';
    hist.push({role:'assistant',content:reply});
    $(tid).remove();
    const fmt=esc(reply).replace(/\*\*(.*?)\*\*/g,'<b>$1</b>').replace(/\n/g,'<br>');
    ca.innerHTML+=`<div class="msg msg-ai"><div class="msg-lbl">AI –ö–û–£–ß</div><div class="bubble">${fmt}</div></div>`;
  }catch(e){
    $(tid).remove();
    ca.innerHTML+=`<div class="msg msg-ai"><div class="bubble" style="color:var(--red)">‚ö†Ô∏è ${esc(e.message||'–ì—Ä–µ—à–∫–∞. –ü—Ä–æ–≤–µ—Ä–∏ proxy URL-–∞.')}</div></div>`;
  }
  sb.disabled=false;
  ca.scrollTop=ca.scrollHeight;
}
function onKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}}

// LEADS
function toggleLF(){const f=$('leadForm');f.style.display=f.style.display==='none'?'block':'none';}
function addLead(){
  const n=$('lName').value.trim(),p=$('lPhone').value.trim();
  if(!n||!p){alert('–ü–æ–ø—ä–ª–Ω–∏ Ime –∏ Telefon');return;}
  leads.unshift({id:Date.now(),name:n,phone:p,src:$('lSrc').value,status:$('lSt').value,note:$('lNote').value.trim(),date:today()});
  S('leads',leads);['lName','lPhone','lNote'].forEach(id=>$(id).value='');
  $('leadForm').style.display='none';renderLeads();
}
function setSt(id,s){leads=leads.map(l=>l.id===id?{...l,status:s}:l);S('leads',leads);renderLeads();}
function delL(id){if(!confirm('–ò–∑—Ç—Ä–∏–π?'))return;leads=leads.filter(l=>l.id!==id);S('leads',leads);renderLeads();}
function renderLeads(){
  $('leadsCount').textContent=leads.filter(l=>l.status!=='–û–¢–ö–ê–ó–ê–ù').length+' –∞–∫—Ç–∏–≤–Ω–∏';
  const list=$('leadsList');
  if(!leads.length){list.innerHTML='<div style="text-align:center;padding:50px;color:var(--dim);font-size:17px">–î–æ–±–∞–≤–∏ –ø—ä—Ä–≤–∏—è –ª–∏–π–¥!</div>';return;}
  list.innerHTML=leads.map(l=>{
    const sc=SC[l.status]||'#666';
    const btns=STATS.filter(s=>s!==l.status).map(s=>`<button class="sbtn" style="border:1.5px solid ${SC[s]||'#666'}55;color:${SC[s]||'#666'}" onclick="setSt(${l.id},'${s}')">‚Üí${s}</button>`).join('');
    return `<div class="lead-card" style="border-left-color:${sc}">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px">
        <div style="flex:1"><div class="lead-name">${esc(l.name)}</div><div class="lead-meta">${esc(l.phone)} ¬∑ ${l.src} ¬∑ ${l.date}</div>${l.note?`<div class="lead-note">${esc(l.note)}</div>`:''}</div>
        <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
          <span class="badge" style="background:${sc}22;color:${sc};border:1px solid ${sc}44">${l.status}</span>
          <button onclick="delL(${l.id})" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:26px;line-height:1;padding:0">√ó</button>
        </div>
      </div>
      <div class="status-btns" style="margin-top:10px">${btns}</div>
    </div>`;
  }).join('');
}

// HABITS
function renderHabits(){
  const days=last7(),t=today();
  $('hHead').innerHTML='<tr><th class="hn">–ù–ê–í–ò–ö</th>'+days.map(d=>`<th style="color:${d===t?'var(--accent)':'var(--dim)'};font-weight:${d===t?700:400}">${DN[new Date(d+'T12:00:00').getDay()]}</th>`).join('')+'</tr>';
  $('hBody').innerHTML=HABITS.map(h=>{
    const cells=days.map(d=>{const done=H.done[h.id+':'+d];return `<td><div class="hcheck" style="border-color:${done?'var(--green)':'var(--border)'};background:${done?'#2ecc7122':'#ffffff08'}" onclick="togH('${h.id}','${d}')">${done?'‚úì':''}</div></td>`;}).join('');
    return `<tr><td class="hn">${h.label}</td>${cells}</tr>`;
  }).join('');
  const done=HABITS.filter(h=>H.done[h.id+':'+t]).length,pct=Math.round(done/HABITS.length*100);
  const b=$('hScore');
  b.textContent=`–î–Ω–µ—Å: ${done}/${HABITS.length} –Ω–∞–≤–∏–∫–∞ ‚Äî ${pct}%`;
  b.style.color=pct>=80?'var(--green)':pct>=50?'var(--accent)':'var(--red)';
  b.style.background=pct>=80?'#2ecc7111':pct>=50?'#f0a83011':'#e74c3c11';
  b.style.borderColor=pct>=80?'#2ecc7133':pct>=50?'#f0a83033':'#e74c3c33';
}
function togH(id,d){H.done[id+':'+d]=!H.done[id+':'+d];S('habits',H);renderHabits();}

// WEEK
function initWeek(){
  $('weekLabel').textContent=new Date().toLocaleDateString('bg-BG',{month:'long',year:'numeric'});
  $('wLead').value=W.lead||'';$('wHold').value=W.hold||'';
  $('wq1').value=W.q1||'';$('wq2').value=W.q2||'';$('wq3').value=W.q3||'';
  $('wRev').textContent=fmtE(W.rev);
}
function saveWeek(){
  W.lead=$('wLead').value;W.hold=$('wHold').value;
  W.q1=$('wq1').value;W.q2=$('wq2').value;W.q3=$('wq3').value;
  S(wk(),W);
}
function addWR(a){W.rev=(W.rev||0)+a;S(wk(),W);$('wRev').textContent=fmtE(W.rev);}

initDay();initWeek();renderHabits();
</script>
</body>
</html>
